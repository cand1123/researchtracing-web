<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pustakana</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Custom styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Light gray background */
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
                         /* Modal transition */
        .modal {
            transition: opacity 0.3s ease-in-out;
            z-index: 50;
        }
        
        /* Modal content animation */
        .modal-content {
            animation: modalSlideIn 0.3s ease-out;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.95) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
        
        /* Collapse transition */
        .collapse-transition {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
        }
        
        /* Table row hover transition */
        .table-row {
            transition: all 0.2s ease-in-out;
        }
        
        /* Button hover transitions */
        .btn-transition {
            transition: all 0.2s ease-in-out;
        }
        
        /* Filter dropdown transition */
        .filter-dropdown {
            transition: all 0.2s ease-in-out;
            transform-origin: top;
        }
        
        /* Status filter text transition */
        .status-text {
            transition: color 0.2s ease-in-out;
        }
        
        /* Toast notification transition */
        .toast-transition {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
    </style>
</head>
<body class="antialiased text-gray-800">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <!-- Header -->
        <header class="mb-8 text-center">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-900">Pustakana Tracing Research Web</h1>
            <p class="text-md text-gray-600 mt-2">View and manage research publication data.</p>
            
        </header>

        <!-- Filter Section -->
        <div class="bg-gray-50 rounded-lg p-4 mb-6 border border-gray-200">
            <div class="flex flex-col sm:flex-row gap-4 items-start sm:items-center">
                <div class="flex-1">
                    <label for="year-filter" class="block text-xs font-medium text-gray-700 mb-1">Filter Tahun</label>
                    <select id="year-filter" class="block w-full px-2 py-1.5 bg-white border border-gray-300 rounded text-xs focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                        <option value="">Semua Tahun</option>
                        <option value="2025">2025</option>
                        <option value="2024">2024</option>
                        <option value="2023">2023</option>
                        <option value="2022">2022</option>
                        <option value="2021">2021</option>
                        <option value="2020">2020</option>
                    </select>
                </div>
                <div class="flex-1">
                    <label class="block text-xs font-medium text-gray-700 mb-1">Filter Status</label>
                    <div class="relative">
                        <button id="status-filter-btn" type="button" class="btn-transition block w-full px-2 py-1.5 bg-white border border-gray-300 rounded text-xs text-left focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 hover:bg-gray-50">
                            <span id="status-filter-text" class="status-text">Semua Status</span>
                            <i class="fas fa-chevron-down float-right text-xs text-gray-400 mt-1"></i>
                        </button>
                        <div id="status-filter-dropdown" class="filter-dropdown hidden absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-48 overflow-y-auto">
                            <div class="p-2 space-y-1">
                                <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 p-1 rounded">
                                    <input type="checkbox" value="" class="status-checkbox rounded border-gray-300 text-indigo-600 focus:ring-indigo-500" checked>
                                    <span class="text-xs text-gray-700">Semua Status</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 p-1 rounded">
                                    <input type="checkbox" value="Draft" class="status-checkbox rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                    <span class="text-xs text-gray-700">Draft</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 p-1 rounded">
                                    <input type="checkbox" value="Submit" class="status-checkbox rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                    <span class="text-xs text-gray-700">Submit</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 p-1 rounded">
                                    <input type="checkbox" value="Review" class="status-checkbox rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                    <span class="text-xs text-gray-700">Review</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 p-1 rounded">
                                    <input type="checkbox" value="Declined" class="status-checkbox rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                    <span class="text-xs text-gray-700">Declined</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 p-1 rounded">
                                    <input type="checkbox" value="Accepted" class="status-checkbox rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                    <span class="text-xs text-gray-700">Accepted</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 p-1 rounded">
                                    <input type="checkbox" value="Published" class="status-checkbox rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                    <span class="text-xs text-gray-700">Published</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content: Table -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-semibold">Research List</h2>
                                         <button id="add-research-btn" class="btn-transition inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                         <i class="fas fa-plus mr-1.5 text-xs"></i>
                         Tambah Penelitian Baru
                     </button>
                </div>
            </div>
            
            <div class="px-6 pb-6">
                <div class="overflow-x-auto">
                    <table class="w-full border-2 border-indigo-200 rounded-lg overflow-hidden table-fixed">
                        <thead class="bg-indigo-50 border-b-2 border-indigo-300">
                            <tr>
                                <th scope="col" class="w-8 px-3 py-3 text-center text-xs font-semibold text-indigo-800 uppercase tracking-wider border-r border-indigo-200">No</th>
                                <th scope="col" class="w-80 px-3 py-3 text-center text-xs font-semibold text-indigo-800 uppercase tracking-wider border-r border-indigo-200">Title</th>
                                <th scope="col" class="w-32 px-3 py-3 text-center text-xs font-semibold text-indigo-800 uppercase tracking-wider border-r border-indigo-200">Accreditation</th>
                                <th scope="col" class="w-32 px-3 py-3 text-center text-xs font-semibold text-indigo-800 uppercase tracking-wider border-r border-indigo-200">Status</th>
                                <th scope="col" class="w-24 px-3 py-3 text-center text-xs font-semibold text-indigo-800 uppercase tracking-wider border-r border-indigo-200">Year</th>
                                <th scope="col" class="w-16 px-3 py-3 text-center text-xs font-semibold text-indigo-800 uppercase tracking-wider">Aksi</th>
                            </tr>
                        </thead>
                                             <tbody id="research-table-body" class="bg-white divide-y divide-indigo-100">
                         <!-- Data akan diisi oleh JavaScript -->
                         <tr class="table-row">
                             <td colspan="6" class="px-6 py-8 text-center text-gray-400">
                                 <div id="loading-spinner" role="status">
                                     <svg aria-hidden="true" class="inline w-5 h-5 text-gray-200 animate-spin fill-gray-400" viewBox="0 0 100 101" fill="none" xmlns="http://www.w3.org/2000/svg">
                                         <path d="M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z" fill="currentColor"/>
                                         <path d="M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0492C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z" fill="currentFill"/>
                                     </svg>
                                     <span class="sr-only">Loading...</span>
                                 </div>
                                 <p id="no-data-message" class="hidden text-xs text-gray-400">Data penelitian tidak ditemukan. Tambahkan data baru menggunakan form di bawah.</p>
                             </td>
                         </tr>
                     </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Add/Edit Research Modal -->
                 <div id="researchModal" class="modal fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden" style="z-index: 9999;">
             <div class="flex items-center justify-center min-h-screen p-4">
                 <div class="relative w-full max-w-3xl p-4 border shadow-lg rounded-md bg-white modal-content">
                 <div class="flex justify-between items-center pb-2 border-b">
                     <h3 id="modal-title" class="text-lg font-semibold text-gray-900">Tambah Penelitian Baru</h3>
                                           <button id="closeResearchModal" class="btn-transition text-gray-400 hover:text-gray-600">
                         <i class="fas fa-times"></i>
                     </button>
                 </div>
                 <div class="mt-4">
                     <form id="research-form" class="space-y-3">
                         <input type="hidden" id="edit-key" name="edit-key">
                         <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                                         <div>
                                 <label for="title" class="block text-xs font-medium text-gray-700">Judul Penelitian</label>
                                 <input type="text" id="title" name="title" required class="mt-1 block w-full px-2 py-1.5 bg-white border border-gray-300 rounded text-xs focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                             </div>
                                                          <div>
                                  <label for="accreditation" class="block text-xs font-medium text-gray-700">Akreditasi</label>
                                  <select id="accreditation" name="accreditation" required class="mt-1 block w-full px-2 py-1.5 bg-white border border-gray-300 rounded text-xs focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                     <option value="">Pilih Akreditasi</option>
                                     <optgroup label="SINTA">
                                         <option value="SINTA 1">SINTA 1</option>
                                         <option value="SINTA 2">SINTA 2</option>
                                         <option value="SINTA 3">SINTA 3</option>
                                         <option value="SINTA 4">SINTA 4</option>
                                     </optgroup>
                                     <optgroup label="Quartile">
                                         <option value="Q1">Q1</option>
                                         <option value="Q2">Q2</option>
                                         <option value="Q3">Q3</option>
                                         <option value="Q4">Q4</option>
                                     </optgroup>
                                 </select>
                             </div>
                                                                                                                   <div>
                                  <label for="status" class="block text-xs font-medium text-gray-700">Status</label>
                                  <select id="status" name="status" class="mt-1 block w-full px-2 py-1.5 bg-white border border-gray-300 rounded text-xs focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                      <option value="">Pilih Status</option>
                                      <option value="Draft">Draft</option>
                                      <option value="Submit">Submit</option>
                                      <option value="Review">Review</option>
                                      <option value="Declined">Declined</option>
                                      <option value="Accepted">Accepted</option>
                                      <option value="Published">Published</option>
                                  </select>
                              </div>
                                                          <div>
                                  <label for="implementation_year" class="block text-xs font-medium text-gray-700">Tahun Implementasi</label>
                                  <select id="implementation_year" name="implementation_year" required class="mt-1 block w-full px-2 py-1.5 bg-white border border-gray-300 rounded text-xs focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                     <option value="">Pilih Tahun</option>
                                     <option value="2025">2025</option>
                                     <option value="2024">2024</option>
                                     <option value="2023">2023</option>
                                     <option value="2022">2022</option>
                                     <option value="2021">2021</option>
                                 </select>
                             </div>
                            <div>
                                <label for="journal_link" class="block text-xs font-medium text-gray-700">Link Jurnal</label>
                                <input type="url" id="journal_link" name="journal_link" class="mt-1 block w-full px-2 py-1.5 bg-white border border-gray-300 rounded text-xs focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="https://...">
                            </div>
                            <div>
                                <label for="doc_link" class="block text-xs font-medium text-gray-700">Link Dokumen</label>
                                <input type="url" id="doc_link" name="doc_link" class="mt-1 block w-full px-2 py-1.5 bg-white border border-gray-300 rounded text-xs focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="https://drive.google.com/...">
                            </div>
                                                         <div id="year-published-container" class="hidden">
                                 <label for="year_published" class="block text-xs font-medium text-gray-700">Tahun Publikasi</label>
                                 <select id="year_published" name="year_published" class="mt-1 block w-full px-2 py-1.5 bg-white border border-gray-300 rounded text-xs focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                     <option value="">Pilih Tahun</option>
                                     <option value="2025">2025</option>
                                     <option value="2024">2024</option>
                                     <option value="2023">2023</option>
                                     <option value="2022">2022</option>
                                     <option value="2021">2021</option>
                                     <option value="2020">2020</option>
                                 </select>
                             </div>
                            <div id="published-link-container" class="hidden">
                                <label for="published_link" class="block text-xs font-medium text-gray-700">Link Publikasi</label>
                                <input type="url" id="published_link" name="published_link" class="mt-1 block w-full px-2 py-1.5 bg-white border border-gray-300 rounded text-xs focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="https://journal.com/...">
                            </div>
                        </div>
                        <div class="flex justify-end space-x-3 pt-3 border-t">
                            <button type="button" id="cancel-btn" class="py-1.5 px-3 border border-gray-300 rounded text-xs font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                Batal
                            </button>
                            <button type="submit" id="submit-btn" class="btn-transition inline-flex justify-center py-1.5 px-3 border border-transparent shadow-sm text-xs font-medium rounded text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                Tambah Penelitian
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        

    </div>

    <!-- Modal for Details -->
    <div id="detailModal" class="modal fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
        <div class="relative top-20 mx-auto p-5 border w-full max-w-2xl shadow-lg rounded-md bg-white">
            <div class="flex justify-between items-center pb-3 border-b">
                <h3 class="text-2xl font-bold text-gray-900">Research Details</h3>
                <button id="closeDetailModal" class="btn-transition text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times fa-lg"></i>
                </button>
            </div>
            <div class="mt-3">
                <pre id="modal-content" class="bg-gray-100 p-4 rounded-lg text-sm whitespace-pre-wrap break-all"></pre>
            </div>
        </div>
    </div>
    
    <!-- Confirmation Modal for Delete -->
    <div id="deleteConfirmModal" class="modal fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
        <div class="relative top-20 mx-auto p-5 border w-full max-w-md shadow-lg rounded-md bg-white">
            <div class="mt-3 text-center">
                <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100">
                    <i class="fas fa-exclamation-triangle text-red-600 fa-lg"></i>
                </div>
                <h3 class="text-lg leading-6 font-medium text-gray-900 mt-2">Hapus Data Penelitian</h3>
                <div class="mt-2 px-7 py-3">
                    <p class="text-sm text-gray-500">Apakah Anda yakin ingin menghapus data ini? Tindakan ini tidak dapat dibatalkan.</p>
                </div>
                <div class="items-center px-4 py-3 space-x-4">
                    <button id="confirmDeleteBtn" class="btn-transition px-4 py-2 bg-red-600 text-white text-base font-medium rounded-md w-auto shadow-sm hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500">
                        Hapus
                    </button>
                    <button id="cancelDeleteBtn" class="btn-transition px-4 py-2 bg-gray-200 text-gray-800 text-base font-medium rounded-md w-auto shadow-sm hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500">
                        Batal
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast-transition fixed bottom-5 right-5 bg-green-500 text-white py-2 px-4 rounded-lg shadow-lg hidden">
        <p id="toast-message"></p>
    </div>

    <!-- PIN Authentication Modal -->
    <div id="pinModal" class="modal fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="relative w-full max-w-md p-4 border shadow-lg rounded-md bg-white modal-content">
                <div class="flex justify-between items-center pb-2 border-b">
                    <h3 id="pin-modal-title" class="text-lg font-semibold text-gray-900">Verifikasi PIN</h3>
                    <button id="closePinModal" class="btn-transition text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="mt-4">
                    <form id="pin-form" class="space-y-4">
                        <div>
                            <label for="pin-input" class="block text-sm font-medium text-gray-700 mb-2">Masukkan PIN untuk melanjutkan</label>
                            <input type="password" id="pin-input" name="pin" required maxlength="8" class="block w-full px-3 py-2 bg-white border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="Masukkan PIN">
                        </div>
                        <div class="flex justify-end space-x-3 pt-3 border-t">
                            <button type="button" id="cancel-pin-btn" class="btn-transition inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                Batal
                            </button>
                            <button type="submit" id="submit-pin-btn" class="btn-transition inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                Verifikasi
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>


    <!-- Firebase SDK -->
    <script type="module">
        // Import functions from the Firebase SDKs
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getDatabase, ref, onValue, push, set, update, remove } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBLgf4hShqSwN6LfiNFHs3FlQjXzs94guw",
            authDomain: "tracing-research.firebaseapp.com",
            databaseURL: "https://tracing-research-default-rtdb.firebaseio.com",
            projectId: "tracing-research",
            storageBucket: "tracing-research.appspot.com",
            messagingSenderId: "1018100569340",
            appId: "1:1018100569340:web:e25cb3e7b0b05143c13379",
            measurementId: "G-9GPNG6GSWH"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const researchRef = ref(database, 'research');

        // DOM Elements
        const tableBody = document.getElementById('research-table-body');
        
        // Filter elements
        const yearFilter = document.getElementById('year-filter');
        const statusFilterBtn = document.getElementById('status-filter-btn');
        const statusFilterDropdown = document.getElementById('status-filter-dropdown');
        const statusFilterText = document.getElementById('status-filter-text');
        const statusCheckboxes = document.querySelectorAll('.status-checkbox');
        
        // Modal elements
        const researchModal = document.getElementById('researchModal');
        const modalTitle = document.getElementById('modal-title');
        const closeResearchModal = document.getElementById('closeResearchModal');
        const addResearchBtn = document.getElementById('add-research-btn');
        const cancelBtn = document.getElementById('cancel-btn');
        


        const deleteConfirmModal = document.getElementById('deleteConfirmModal');
        const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
        const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
        
        // PIN Modal elements
        const pinModal = document.getElementById('pinModal');
        const pinModalTitle = document.getElementById('pin-modal-title');
        const closePinModal = document.getElementById('closePinModal');
        const cancelPinBtn = document.getElementById('cancel-pin-btn');
        const pinForm = document.getElementById('pin-form');
        const pinInput = document.getElementById('pin-input');
        
                 const researchForm = document.getElementById('research-form');
         const submitBtn = document.getElementById('submit-btn');
         const statusSelect = document.getElementById('status');
         const yearPublishedContainer = document.getElementById('year-published-container');
         const publishedLinkContainer = document.getElementById('published-link-container');
         
         const toast = document.getElementById('toast');
         const toastMessage = document.getElementById('toast-message');

        let allData = {}; // To store the fetched data globally
        let keyToDelete = null; // To store key for deletion confirmation
        let pendingAction = null; // To store pending action after PIN verification
        let pendingActionData = null; // To store data for pending action
        


        // --- Data Fetching and Table Population ---
        onValue(researchRef, (snapshot) => {
            tableBody.innerHTML = ''; // Clear existing table data
            const data = snapshot.val();
            allData = data; // Store data for later use (edit/delete)

            if (data) {
                let counter = 1;
                Object.entries(data).forEach(([key, value]) => {
                    const row = document.createElement('tr');
                    row.classList.add('hover:bg-gray-50', 'table-row');
                    
                    row.innerHTML = `
                        <td class="w-16 px-3 py-3 whitespace-nowrap text-xs text-gray-600 border-r border-indigo-200">${counter++}</td>
                        <td class="w-80 px-3 py-3 whitespace-nowrap border-r border-indigo-200">
                            <div class="text-xs font-medium text-gray-800 truncate">${value.title || 'N/A'}</div>
                        </td>
                        <td class="w-32 px-3 py-3 whitespace-nowrap border-r border-indigo-200">
                            <span class="px-2 py-1 inline-flex text-xs font-medium rounded-md bg-gray-100 text-gray-700">
                                ${value.accreditation || 'N/A'}
                            </span>
                        </td>
                        <td class="w-32 px-3 py-3 whitespace-nowrap border-r border-indigo-200">
                            <span class="px-2 py-1 inline-flex text-xs font-medium rounded-md ${getStatusColor(value.status)}">
                                ${value.status || 'N/A'}
                            </span>
                        </td>
                        <td class="w-24 px-3 py-3 whitespace-nowrap text-xs text-gray-600 border-r border-indigo-200">${value.implementation_year || 'N/A'}</td>
                        <td class="w-32 px-3 py-3 whitespace-nowrap text-center text-xs font-medium space-x-1">
                            <button data-key="${key}" class="btn-transition view-btn p-1.5 text-gray-500 hover:text-green-600 hover:bg-green-50 rounded transition-colors" title="View"><i class="fas fa-eye"></i></button>
                            <button data-key="${key}" class="btn-transition delete-btn p-1.5 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded transition-colors" title="Delete"><i class="fas fa-trash"></i></button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                    
                    // Add collapse row for details
                    const collapseRow = document.createElement('tr');
                    collapseRow.id = `collapse-${key}`;
                    collapseRow.classList.add('hidden', 'bg-gray-50', 'collapse-transition');
                    collapseRow.innerHTML = `
                        <td colspan="6" class="px-6 py-4">
                            <div class="border-2 border-indigo-200 rounded-lg p-4 bg-white shadow-sm">
                                <div class="space-y-4">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div class="border border-gray-200 rounded-lg p-3 bg-gray-50">
                                            <h4 class="text-sm font-semibold text-gray-700 mb-2">Detail Penelitian</h4>
                                            <div class="space-y-2 text-xs">
                                                <div class="border-b border-gray-100 pb-1"><span class="font-medium text-gray-600">Judul:</span> <span class="text-gray-800">${value.title || 'N/A'}</span></div>
                                                <div class="border-b border-gray-100 pb-1"><span class="font-medium text-gray-600">Akreditasi:</span> <span class="text-gray-800">${value.accreditation || 'N/A'}</span></div>
                                                <div class="border-b border-gray-100 pb-1"><span class="font-medium text-gray-600">Status:</span> <span class="px-2 py-1 inline-flex text-xs font-medium rounded-md ${getStatusColor(value.status)}">${value.status || 'N/A'}</span></div>
                                                <div><span class="font-medium text-gray-600">Tahun Implementasi:</span> <span class="text-gray-800">${value.implementation_year || 'N/A'}</span></div>
                                            </div>
                                        </div>
                                        <div class="border border-gray-200 rounded-lg p-3 bg-gray-50">
                                            <h4 class="text-sm font-semibold text-gray-700 mb-2">Link & Publikasi</h4>
                                            <div class="space-y-2 text-xs">
                                                <div class="border-b border-gray-100 pb-1"><span class="font-medium text-gray-600">Link Jurnal:</span> <a href="${value.journal_link || '#'}" target="_blank" class="text-blue-600 hover:underline">${value.journal_link || 'Tidak ada'}</a></div>
                                                <div class="border-b border-gray-100 pb-1"><span class="font-medium text-gray-600">Link Dokumen:</span> <a href="${value.doc_link || '#'}" target="_blank" class="text-blue-600 hover:underline">${value.doc_link || 'Tidak ada'}</a></div>
                                                ${value.published?.year_published ? `<div class="border-b border-gray-100 pb-1"><span class="font-medium text-gray-600">Tahun Publikasi:</span> <span class="text-gray-800">${value.published.year_published}</span></div>` : ''}
                                                ${value.published?.published_link ? `<div><span class="font-medium text-gray-600">Link Publikasi:</span> <a href="${value.published.published_link}" target="_blank" class="text-blue-600 hover:underline">${value.published.published_link}</a></div>` : ''}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex justify-end space-x-2 pt-3 border-t border-gray-200">
                                        <button data-key="${key}" class="btn-transition edit-inline-btn inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                            <i class="fas fa-pencil-alt mr-1.5 text-xs"></i>
                                            Edit
                                        </button>
                                        <button data-key="${key}" class="btn-transition close-collapse-btn inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">
                                            <i class="fas fa-times mr-1.5 text-xs"></i>
                                            Tutup
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </td>
                    `;
                    tableBody.appendChild(collapseRow);
                });
            } else {
                // Show "Tidak ada data" when no data exists
                const emptyRow = `<tr><td colspan="6" class="px-6 py-8 text-center text-gray-400">
                    <div class="text-sm text-gray-400">Tidak ada data</div>
                </td></tr>`;
                tableBody.innerHTML = emptyRow;
            }
        });

        // --- Event Delegation for Table Actions ---
        tableBody.addEventListener('click', (e) => {
            const targetButton = e.target.closest('button');
            if (!targetButton) return;

            const key = targetButton.dataset.key;
            if (targetButton.classList.contains('view-btn')) {
                toggleCollapse(key);
            } else if (targetButton.classList.contains('edit-inline-btn')) {
                requirePinAuth('edit', key, allData[key]);
            } else if (targetButton.classList.contains('delete-btn')) {
                requirePinAuth('delete', key);
            } else if (targetButton.classList.contains('close-collapse-btn')) {
                hideCollapse(key);
            }
        });

        // --- Filter Event Listeners ---
        yearFilter.addEventListener('change', applyFilters);
        statusFilterBtn.addEventListener('click', toggleStatusDropdown);
        
        // Status filter dropdown functionality
        statusCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', handleStatusCheckboxChange);
        });
        
        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            if (!statusFilterBtn.contains(e.target) && !statusFilterDropdown.contains(e.target)) {
                statusFilterDropdown.classList.add('hidden');
            }
        });

                 // --- Modal Functionality ---
         
         // Status change handler for year published and published link visibility
         statusSelect.addEventListener('change', function() {
             if (this.value === 'Published') {
                 yearPublishedContainer.classList.remove('hidden');
                 publishedLinkContainer.classList.remove('hidden');
             } else {
                 yearPublishedContainer.classList.add('hidden');
                 publishedLinkContainer.classList.add('hidden');
                 // Reset year published and published link values when status is not Published
                 document.getElementById('year_published').value = '';
                 document.getElementById('published_link').value = '';
             }
         });
         
                           // Add Research Modal
        addResearchBtn.addEventListener('click', () => {
            requirePinAuth('add');
        });
        

        
        closeResearchModal.addEventListener('click', hideResearchModal);
        cancelBtn.addEventListener('click', hideResearchModal);
        
        // Close modal when clicking outside
        researchModal.addEventListener('click', (e) => {
            if (e.target === researchModal) {
                hideResearchModal();
            }
        });

        // PIN Modal Event Listeners
        closePinModal.addEventListener('click', hidePinModal);
        cancelPinBtn.addEventListener('click', hidePinModal);
        
        // Close PIN modal when clicking outside
        pinModal.addEventListener('click', (e) => {
            if (e.target === pinModal) {
                hidePinModal();
            }
        });

        // PIN Form Submit
        pinForm.addEventListener('submit', handlePinSubmit);
        
        // --- PIN Authentication Functions ---
        function requirePinAuth(action, key = null, data = null) {
            // Set pending action BEFORE showing modal
            pendingAction = action;
            pendingActionData = { key, data };
            
            // Set modal title based on action
            switch (action) {
                case 'add':
                    pinModalTitle.textContent = 'Verifikasi PIN - Tambah Penelitian';
                    break;
                case 'edit':
                    pinModalTitle.textContent = 'Verifikasi PIN - Edit Penelitian';
                    break;
                case 'delete':
                    pinModalTitle.textContent = 'Verifikasi PIN - Hapus Penelitian';
                    break;
            }
            
            // Show PIN modal
            pinModal.classList.remove('hidden');
            pinInput.focus();
            pinInput.value = '';
        }

        function hidePinModal() {
            pinModal.classList.add('hidden');
            
            // DON'T reset these variables here - they're needed for executePendingAction
            // pendingAction = null;
            // pendingActionData = null;
            
            pinInput.value = '';
        }

        function handlePinSubmit(e) {
            e.preventDefault();
            const enteredPin = pinInput.value;
            
            // Check if PIN is correct (direct comparison for now)
            if (enteredPin === '27071997') {
                // PIN is correct, proceed with action
                hidePinModal();
                executePendingAction();
            } else {
                // PIN is incorrect
                showToast('PIN salah! Silakan coba lagi.', 'error');
                pinInput.value = '';
                pinInput.focus();
            }
        }



        function executePendingAction() {
            if (!pendingAction) {
                return;
            }
            
            switch (pendingAction) {
                case 'add':
                    showResearchModal('add');
                    break;
                case 'edit':
                    showResearchModal('edit', pendingActionData.key, pendingActionData.data);
                    break;
                case 'delete':
                    showDeleteConfirmModal(pendingActionData.key);
                    break;
            }
            
            // Clear pending action
            pendingAction = null;
            pendingActionData = null;
        }

        function showResearchModal(mode, key = null, data = null) {
            if (mode === 'add') {
                modalTitle.textContent = 'Tambah Penelitian Baru';
                submitBtn.textContent = 'Tambah Penelitian';
                submitBtn.className = 'inline-flex justify-center py-1.5 px-3 border border-transparent shadow-sm text-xs font-medium rounded text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500';
                resetFormToDefault();
            } else if (mode === 'edit') {
                modalTitle.textContent = 'Edit Penelitian';
                submitBtn.textContent = 'Update Penelitian';
                submitBtn.className = 'inline-flex justify-center py-1.5 px-3 border border-transparent shadow-sm text-xs font-medium rounded text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500';
                setupEditForm(key, data);
            }
            
            if (researchModal) {
                researchModal.classList.remove('hidden');
            }
        }
        
        function hideResearchModal() {
            if (researchModal) {
                researchModal.classList.add('hidden');
            }
            resetFormToDefault();
        }

        function showDeleteConfirmModal(key) {
            keyToDelete = key;
            deleteConfirmModal.classList.remove('hidden');
        }
        function hideDeleteConfirmModal() {
            keyToDelete = null;
            deleteConfirmModal.classList.add('hidden');
        }
        cancelDeleteBtn.addEventListener('click', hideDeleteConfirmModal);

        // --- Form and CRUD Logic ---
                 function setupEditForm(key, data) {
             researchForm.querySelector('#edit-key').value = key;
             researchForm.querySelector('#title').value = data.title || '';
             researchForm.querySelector('#accreditation').value = data.accreditation || '';
             researchForm.querySelector('#status').value = data.status || 'Published';
             researchForm.querySelector('#implementation_year').value = data.implementation_year || '';
             researchForm.querySelector('#journal_link').value = data.doc_link || '';
             researchForm.querySelector('#doc_link').value = data.doc_link || '';
             researchForm.querySelector('#year_published').value = data.published?.year_published || '';
             researchForm.querySelector('#published_link').value = data.published?.published_link || '';
             
             // Show/hide year published and published link fields based on status
             if (data.status === 'Published') {
                 yearPublishedContainer.classList.remove('hidden');
                 publishedLinkContainer.classList.remove('hidden');
             } else {
                 yearPublishedContainer.classList.add('hidden');
                 publishedLinkContainer.classList.add('hidden');
             }
         }

                 function resetFormToDefault() {
             researchForm.reset();
             researchForm.querySelector('#edit-key').value = '';
             // Hide year published and published link fields by default
             yearPublishedContainer.classList.add('hidden');
             publishedLinkContainer.classList.add('hidden');
         }
        
        researchForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const formData = new FormData(researchForm);
            const key = formData.get('edit-key');
            
            const researchData = {
                title: formData.get('title'),
                accreditation: formData.get('accreditation'),
                status: formData.get('status'),
                journal_link: formData.get('journal_link'),
                doc_link: formData.get('doc_link'),
                implementation_year: parseInt(formData.get('implementation_year')),
                published: {
                    year_published: parseInt(formData.get('year_published')) || null,
                    published_link: formData.get('published_link') || ''
                }
            };

            if (key) { // Update existing data
                const itemRef = ref(database, 'research/' + key);
                update(itemRef, researchData)
                    .then(() => {
                        showToast('Penelitian berhasil diperbarui!', 'success');
                        hideResearchModal();
                    })
                    .catch((error) => {
                        console.error("Error updating document: ", error);
                        showToast('Error memperbarui penelitian.', 'error');
                    });
            } else { // Add new data
                const newResearchRef = push(researchRef);
                set(newResearchRef, researchData)
                    .then(() => {
                        showToast('Penelitian berhasil ditambahkan!', 'success');
                        hideResearchModal();
                    })
                    .catch((error) => {
                        console.error("Error adding document: ", error);
                        showToast('Error menambahkan penelitian.', 'error');
                    });
            }
        });

        confirmDeleteBtn.addEventListener('click', () => {
            if (keyToDelete) {
                const itemRef = ref(database, 'research/' + keyToDelete);
                remove(itemRef)
                    .then(() => {
                        showToast('Research deleted successfully.', 'success');
                    })
                    .catch((error) => {
                        console.error("Error deleting document: ", error);
                        showToast('Error deleting research.', 'error');
                    })
                    .finally(() => {
                        hideDeleteConfirmModal();
                    });
            }
        });
        
        // --- Helper Functions ---
        function getStatusColor(status) {
            switch (status) {
                case 'Draft': return 'bg-gray-50 text-gray-700';
                case 'Submit': return 'bg-blue-50 text-blue-700';
                case 'Review': return 'bg-amber-50 text-amber-700';
                case 'Declined': return 'bg-red-50 text-red-700';
                case 'Accepted': return 'bg-emerald-50 text-emerald-700';
                case 'Published': return 'bg-purple-50 text-purple-700';
                default: return 'bg-gray-50 text-gray-700';
            }
        }

        // --- Filter Functions ---
        function applyFilters() {
            const selectedYear = yearFilter.value;
            const selectedStatuses = getSelectedStatuses();
            
            // Filter data based on selections
            const filteredData = {};
            Object.entries(allData).forEach(([key, value]) => {
                let yearMatch = true;
                let statusMatch = true;
                
                if (selectedYear && value.implementation_year != selectedYear) {
                    yearMatch = false;
                }
                
                if (selectedStatuses.length > 0 && !selectedStatuses.includes(value.status)) {
                    statusMatch = false;
                }
                
                if (yearMatch && statusMatch) {
                    filteredData[key] = value;
                }
            });
            
            // Update table with filtered data
            updateTableDisplay(filteredData);
        }
        
        function toggleStatusDropdown() {
            statusFilterDropdown.classList.toggle('hidden');
        }
        
        function handleStatusCheckboxChange() {
            const allCheckbox = document.querySelector('.status-checkbox[value=""]');
            const otherCheckboxes = document.querySelectorAll('.status-checkbox:not([value=""])');
            
            if (this.value === '') {
                // "Semua Status" checkbox clicked
                if (this.checked) {
                    // Uncheck all other checkboxes
                    otherCheckboxes.forEach(cb => cb.checked = false);
                } else {
                    // If unchecking "Semua Status", check at least one other
                    if (otherCheckboxes.every(cb => !cb.checked)) {
                        this.checked = true;
                        return;
                    }
                }
            } else {
                // Other checkbox clicked
                if (this.checked) {
                    // Uncheck "Semua Status"
                    allCheckbox.checked = false;
                } else {
                    // If no other checkbox is checked, check "Semua Status"
                    if (otherCheckboxes.every(cb => !cb.checked)) {
                        allCheckbox.checked = true;
                    }
                }
            }
            
            updateStatusFilterText();
            applyFilters();
        }
        
        function getSelectedStatuses() {
            const selectedStatuses = [];
            statusCheckboxes.forEach(checkbox => {
                if (checkbox.checked && checkbox.value !== '') {
                    selectedStatuses.push(checkbox.value);
                }
            });
            return selectedStatuses;
        }
        
        function updateStatusFilterText() {
            const selectedStatuses = getSelectedStatuses();
            if (selectedStatuses.length === 0) {
                statusFilterText.textContent = 'Semua Status';
            } else if (selectedStatuses.length === 1) {
                statusFilterText.textContent = selectedStatuses[0];
            } else {
                statusFilterText.textContent = `${selectedStatuses.length} Status Dipilih`;
            }
        }
        
        // --- Collapse Functions ---
        function toggleCollapse(key) {
            const collapseRow = document.getElementById(`collapse-${key}`);
            if (collapseRow) {
                // Hide all other collapse rows first
                document.querySelectorAll('[id^="collapse-"]').forEach(row => {
                    if (row.id !== `collapse-${key}`) {
                        row.classList.add('hidden');
                    }
                });
                
                // Toggle current collapse row
                collapseRow.classList.toggle('hidden');
            }
        }
        
        function hideCollapse(key) {
            const collapseRow = document.getElementById(`collapse-${key}`);
            if (collapseRow) {
                collapseRow.classList.add('hidden');
            }
        }
        

        
        function updateTableDisplay(data) {
            tableBody.innerHTML = '';
            
            if (Object.keys(data).length === 0) {
                const noResultsRow = `<tr><td colspan="6" class="px-6 py-12 text-center text-gray-500">
                    <div class="text-sm text-gray-400">Tidak ada data yang sesuai dengan filter yang dipilih.</div>
                </td></tr>`;
                tableBody.innerHTML = noResultsRow;
                return;
            }
            
            let counter = 1;
            Object.entries(data).forEach(([key, value]) => {
                const row = document.createElement('tr');
                row.classList.add('hover:bg-gray-50', 'table-row');
                
                row.innerHTML = `
                    <td class="w-16 px-3 py-3 whitespace-nowrap text-xs text-gray-600 border-r border-indigo-200">${counter++}</td>
                    <td class="w-80 px-3 py-3 whitespace-nowrap border-r border-indigo-200">
                        <div class="text-xs font-medium text-gray-800 truncate">${value.title || 'N/A'}</div>
                    </td>
                    <td class="w-32 px-3 py-3 whitespace-nowrap border-r border-indigo-200">
                        <span class="px-2 py-1 inline-flex text-xs font-medium rounded-md bg-gray-100 text-gray-700">
                            ${value.accreditation || 'N/A'}
                        </span>
                    </td>
                    <td class="w-32 px-3 py-3 whitespace-nowrap border-r border-indigo-200">
                        <span class="px-2 py-1 inline-flex text-xs font-medium rounded-md ${getStatusColor(value.status)}">
                            ${value.status || 'N/A'}
                        </span>
                    </td>
                    <td class="w-24 px-3 py-3 whitespace-nowrap text-xs text-gray-600 border-r border-indigo-200">${value.implementation_year || 'N/A'}</td>
                    <td class="w-32 px-3 py-3 whitespace-nowrap text-center text-xs font-medium space-x-1">
                        <button data-key="${key}" class="btn-transition view-btn p-1.5 text-gray-500 hover:text-green-600 hover:bg-green-50 rounded transition-colors" title="View"><i class="fas fa-eye"></i></button>
                        <button data-key="${key}" class="btn-transition delete-btn p-1.5 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded transition-colors" title="Delete"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                tableBody.appendChild(row);
                
                // Add collapse row for details
                const collapseRow = document.createElement('tr');
                collapseRow.id = `collapse-${key}`;
                collapseRow.classList.add('hidden', 'bg-gray-50', 'collapse-transition');
                collapseRow.innerHTML = `
                    <td colspan="6" class="px-6 py-4">
                        <div class="border-2 border-indigo-200 rounded-lg p-4 bg-white shadow-sm">
                            <div class="space-y-4">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="border border-gray-200 rounded-lg p-3 bg-gray-50">
                                        <h4 class="text-sm font-semibold text-gray-700 mb-2">Detail Penelitian</h4>
                                        <div class="space-y-2 text-xs">
                                            <div class="border-b border-gray-100 pb-1"><span class="font-medium text-gray-600">Judul:</span> <span class="text-gray-800">${value.title || 'N/A'}</span></div>
                                            <div class="border-b border-gray-100 pb-1"><span class="font-medium text-gray-600">Akreditasi:</span> <span class="text-gray-800">${value.accreditation || 'N/A'}</span></div>
                                            <div class="border-b border-gray-100 pb-1"><span class="font-medium text-gray-600">Status:</span> <span class="px-2 py-1 inline-flex text-xs font-medium rounded-md ${getStatusColor(value.status)}">${value.status || 'N/A'}</span></div>
                                            <div><span class="font-medium text-gray-600">Tahun Implementasi:</span> <span class="text-gray-800">${value.implementation_year || 'N/A'}</span></div>
                                        </div>
                                    </div>
                                    <div class="border border-gray-200 rounded-lg p-3 bg-gray-50">
                                        <h4 class="text-sm font-semibold text-gray-700 mb-2">Link & Publikasi</h4>
                                        <div class="space-y-2 text-xs">
                                            <div class="border-b border-gray-100 pb-1"><span class="font-medium text-gray-600">Link Jurnal:</span> <a href="${value.journal_link || '#'}" target="_blank" class="text-blue-600 hover:underline">${value.journal_link || 'Tidak ada'}</a></div>
                                            <div class="border-b border-gray-100 pb-1"><span class="font-medium text-gray-600">Link Dokumen:</span> <a href="${value.doc_link || '#'}" target="_blank" class="text-blue-600 hover:underline">${value.doc_link || 'Tidak ada'}</a></div>
                                            ${value.published?.year_published ? `<div class="border-b border-gray-100 pb-1"><span class="font-medium text-gray-600">Tahun Publikasi:</span> <span class="text-gray-800">${value.published.year_published}</span></div>` : ''}
                                            ${value.published?.published_link ? `<div><span class="border-b border-gray-100 pb-1"><span class="font-medium text-gray-600">Link Publikasi:</span> <a href="${value.published.published_link}" target="_blank" class="text-blue-600 hover:underline">${value.published.published_link}</a></span></div>` : ''}
                                        </div>
                                    </div>
                                </div>
                                <div class="flex justify-end space-x-2 pt-3 border-t border-gray-200">
                                    <button data-key="${key}" class="btn-transition edit-inline-btn inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                        <i class="fas fa-pencil-alt mr-1.5 text-xs"></i>
                                        Edit
                                    </button>
                                    <button data-key="${key}" class="btn-transition close-collapse-btn inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">
                                        <i class="fas fa-times mr-1.5 text-xs"></i>
                                        Tutup
                                    </button>
                                </div>
                            </div>
                        </div>
                    </td>
                `;
                tableBody.appendChild(collapseRow);
            });
        }
        
        function showToast(message, type = 'success') {
            toastMessage.textContent = message;
            toast.classList.remove('hidden', 'bg-green-500', 'bg-red-500');
            
            if (type === 'success') {
                toast.classList.add('bg-green-500');
            } else {
                toast.classList.add('bg-red-500');
            }
            
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 3000);
        }

    </script>
</body>
</html>