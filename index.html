<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pustakana</title>
    <!-- Tempel gambar img.png di tampilan -->
    <link rel="icon" type="image/png" href="img.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Custom styles */
        body {
            font-family: 'Inter', sans-serif;
                background-color: #f3f4f6;
        }
            
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
            /* Table layout */
        .fixed-table {
            table-layout: fixed;
            width: 100%;
            border-collapse: collapse;
        }
        
        .fixed-table th,
        .fixed-table td {
            overflow: visible;
            text-overflow: clip;
            white-space: normal;
            word-wrap: break-word;
            hyphens: auto;
        }
        
        /* Column sizing */
        .col-no {
            width: 64px !important;
            min-width: 64px !important;
            max-width: 64px !important;
            text-align: center;
        }
        
        .col-title {
            width: 320px !important;
            min-width: 320px !important;
            max-width: 320px !important;
            white-space: normal !important;
            word-wrap: break-word !important;
            overflow-wrap: break-word !important;
            text-transform: capitalize !important;
            text-align: left;
        }
        
        .col-accreditation {
            width: 128px !important;
            min-width: 128px !important;
            max-width: 128px !important;
            text-align: center;
            white-space: nowrap !important;
            overflow: hidden !important;
            text-overflow: ellipsis !important;
        }
        
        .col-status {
            width: 128px !important;
            min-width: 128px !important;
            max-width: 128px !important;
            text-align: center;
        }
        
        .col-year {
            width: 96px !important;
            min-width: 96px !important;
            max-width: 96px !important;
            text-align: center;
        }
        
        .col-actions {
            width: 128px !important;
            min-width: 128px !important;
            max-width: 128px !important;
            text-align: center;
        }
            
            /* Table styling */
        .table_component {
            width: 100%;
            overflow-x: auto;
        }
        
        .fresh-table {
            border: 1px solid #dededf;
            height: 100%;
            width: 100%;
            table-layout: auto;
        }
        
        /* Sticky positioning for first column */
        .sticky {
            position: sticky;
            left: 0;
            z-index: 10;
        }
        
        /* Ensure sticky columns have proper background */
        .sticky.bg-gray-50 {
            background-color: #f9fafb !important;
        }
        
        .sticky.bg-white {
            background-color: #ffffff !important;
        }
        
        .fresh-table {
            border-collapse: collapse;
            border-spacing: 0;
            text-align: left;
            border: 1px solid #e5e7eb;
            background: #ffffff;
        }
            
            /* Body styling */
        .fresh-body tr {
            border-bottom: 1px solid #e5e7eb;
        }
        
        .fresh-body tr:hover {
            background: #f9fafb;
        }
        
        .fresh-body tr:last-child {
            border-bottom: none;
        }
            
        .fresh-body td {
            padding: 12px 16px;
            border: none;
            vertical-align: middle;
            font-size: 12px;
            background-color: #ffffff;
            color: #374151;
            box-sizing: border-box;
        }
            
            /* Row styling */
        .table-row {
            background: #ffffff;
        }
        
        .table-row:nth-child(even) {
            background: #fafafa;
        }
        
        .table-row:nth-child(odd) {
            background: #ffffff;
        }
            
        .table-row:hover {
            background-color: #f9fafb;
        }
            
        .table-row td {
            padding: 12px 16px;
            background-color: transparent;
            color: #374151;
            font-weight: 500;
            border: none;
            box-sizing: border-box;
        }
            

        
            /* Collapse styling */
        .collapse-transition {
            background-color: #f9fafb;
            border-bottom: 1px solid #e5e7eb;
        }
            
        .collapse-transition td {
            padding: 16px;
            box-sizing: border-box;
        }
            
            /* Badge styling */
            .fresh-badge {
                padding: 4px 8px;
                font-size: 12px;
                font-weight: 500;
                letter-spacing: 0.2px;
                text-transform: uppercase;
                border: 1px solid #e5e7eb;

                display: inline-block;
                line-height: 1.4;
                border-radius: 4px;
                margin: 0;
                background: #ffffff;
                color: #374151;
            }
            
            .fresh-badge.published {
                background: #f0fdf4;
                color: #166534;
                border-color: #bbf7d0;
            }
            
            .fresh-badge.writing {
                background: #f3e8ff;
                color: #7c3aed;
                border-color: #c4b5fd;
            }
        
            .fresh-badge.review {
                background: #fffbeb;
                color: #92400e;
                border-color: #fde68a;
            }
        
            .fresh-badge.submit {
                background: #eff6ff;
                color: #1e40af;
                border-color: #bfdbfe;
            }
        
            .fresh-badge.declined {
                background: #fef2f2;
                color: #991b1b;
                border-color: #fecaca;
            }
        
            /* Accreditation badges */
            .accreditation-badge {
                padding: 4px 8px;
                font-size: 12px;
                font-weight: 500;
                text-transform: capitalize !important;
                text-align: center;
                border: 1px solid #e5e7eb;
                border-radius: 4px;
                background: #ffffff;
                color: #374151;
                display: inline-block;
            }
            
        .accreditation-sinta1 {
            background: #fffbeb;
            color: #92400e;
            border-color: #fde68a;
        }
        
        .accreditation-sinta2 {
            background: #eff6ff;
            color: #1e40af;
            border-color: #bfdbfe;
        }
        
        .accreditation-sinta3 {
            background: #f0fdf4;
            color: #166534;
            border-color: #bbf7d0;
        }
        
        .accreditation-sinta4 {
            background: #faf5ff;
            color: #7c3aed;
            border-color: #e9d5ff;
        }
        
        .accreditation-q1 {
            background: #fffbeb;
            color: #92400e;
            border-color: #fde68a;
        }
        
        .accreditation-q2 {
            background: #eff6ff;
            color: #1e40af;
            border-color: #bfdbfe;
        }
        
        .accreditation-q3 {
            background: #f0fdf4;
            color: #166534;
            border-color: #bbf7d0;
        }
        
        .accreditation-q4 {
            background: #faf5ff;
            color: #7c3aed;
            border-color: #e9d5ff;
        }
        
            /* Button styling */
        .fresh-button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 6px 8px;
            border: 1px solid #e5e7eb;
            font-size: 0.75rem;
            font-weight: 500;
            text-decoration: none;
            cursor: pointer;
            min-width: auto;
            height: auto;
            background: #ffffff;
            color: #374151;

            border-radius: 4px;
        }
        
        .fresh-button:hover {
            background: #f9fafb;
            border-color: #d1d5db;
            color: #111827;
        }
        
        .fresh-button.view-btn {
            background: #eff6ff;
            color: #1e40af;
            border-color: #bfdbfe;
        }
        
        .fresh-button.view-btn:hover {
            background: #dbeafe;
            border-color: #93c5fd;
        }
        
        .fresh-button.edit-btn {
            background: #f0fdf4;
            color: #166534;
            border-color: #bbf7d0;
        }
        
        .fresh-button.edit-btn:hover {
            background: #dcfce7;
            border-color: #86efac;
        }
        
        .fresh-button.delete-btn {
            background: #fef2f2;
            color: #991b1b;
            border-color: #fecaca;
        }
        
        .fresh-button.delete-btn:hover {
            background: #fee2e2;
            border-color: #fca5a5;
        }
            
            /* Pagination styling */
        .fresh-pagination-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
                padding: 6px 12px;
            border: 1px solid #e5e7eb;
                background: white;
            color: #374151;
                font-size: 11px;
            font-weight: 500;
            text-decoration: none;
            cursor: pointer;
            min-width: 1.5rem;
            height: 1.5rem;

        }
        
        .fresh-pagination-btn:hover:not(:disabled) {
                background: #f3f4f6;
                border-color: #d1d5db;
        }
        
        .fresh-pagination-btn.active {
                background: #667eea;
                color: white;
                border-color: #667eea;
        }
        
        .fresh-pagination-btn.active:hover {
                background: #5a67d8;
            color: #000000;
        }
        
            .fresh-pagination-btn:disabled {
                opacity: 0.5;
                cursor: not-allowed;
            }
            
            /* Select styling */
        .fresh-select {
                padding: 2px 6px;
                border: 1px solid #e5e7eb;
                background: white;
                font-size: 11px;
            color: #374151;
                cursor: pointer;
                border-radius: 0 !important;
        }
        
        .fresh-select:focus {
            outline: none;
                border-color: #667eea;
                box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
            }
            
            /* Filter styling */
        .filter-select, .filter-button {
            display: block;
            width: 100%;
            padding: 0.5rem 0.30rem;
            background-color: white;
            border: 1px solid #d1d5db;
            font-size: 0.75rem;
            outline: none;
            height: 1.9rem;
            min-height: 1rem;
            box-sizing: border-box;
            line-height: 1.5;
                border-radius: 0 !important;
        }
        
        .filter-select:focus, .filter-button:focus {
            border-color: #6366f1;
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.1);
        }
        
        .filter-button {
            text-align: left;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .filter-button:hover {
            background-color: #f9fafb;
        }
        
        .filter-dropdown {
            position: absolute;
            z-index: 10;
            margin-top: 0.25rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            max-height: 12rem;
            overflow-y: auto;
            width: 100%;
            background-color: white;
            border: 1px solid #d1d5db;
            border-radius: 0;
        }
        
        .filter-dropdown .text-xs {
            font-size: 0.75rem !important;
        }
        
        /* Simple checkbox styling - no special appearance when active */
        .status-checkbox {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            width: 16px;
            height: 16px;
            margin: 0;
            padding: 0;
            cursor: pointer;
            border: 1px solid #d1d5db;
            border-radius: 3px;
            background-color: #ffffff;
            position: relative;
        }
        
        .status-checkbox:checked {
            background-color: #ffffff;
            border-color: #d1d5db;
        }
        
        .status-checkbox:checked::after {
            content: '';
            position: absolute;
            left: 4px;
            top: 1px;
            width: 6px;
            height: 10px;
            border: solid #6b7280;
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
        }
        
        .status-checkbox:focus {
            outline: none;
            box-shadow: none;
        }
        
        .status-checkbox:hover {
            border-color: #9ca3af;
        }
        
        /* Search input styling for realtime feedback */
        #id-search, #title-search {
            transition: all 0.3s ease;
        }
        
        #id-search:focus, #title-search:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        #id-search:not(:placeholder-shown), #title-search:not(:placeholder-shown) {
            border-color: #10b981;
            background-color: #f0fdf4;
        }
        
            /* Text styling */
            .text-wrap {
                white-space: normal !important;
                word-wrap: break-word !important;
                overflow-wrap: break-word !important;
                line-height: 1.4 !important;
            text-transform: capitalize !important;
        }

        .status-text {
            color: #374151;
            font-weight: 500;
            text-transform: capitalize !important;
            text-align: center;
        }

        @media (max-width: 1024px) and (min-width: 641px) {
            .sm\:text-sm {
                font-size: 0.70rem;
                line-height: 1.25rem;
            }
        }

        /* Filter section font size */
        .filter-section label {
            font-size: 0.875rem !important;
        }

        .filter-section .text-xs {
            font-size: 0.75rem !important;
        }

        .filter-section .text-gray-700 {
            font-size: 0.75rem !important;
        }

            /* Input styling */
        .fresh-input {
            border: 2px solid #e5e7eb;
            border-radius: 6px;
            padding: 6px 8px;

            background: white;
        }
        
        .fresh-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            outline: none;
        }
        
        .border-red-300 {
            border-color: #fca5a5 !important;
        }
        
        .border-red-300:focus {
            border-color: #ef4444 !important;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1) !important;
        }
        
            /* Modal styling */
        .fresh-modal {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(8px);
        }
        
        .fresh-modal-content {
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            border: none;
        }
        
            /* Card styling */
                    .fresh-card {
                background: white;
                border-radius: 6px;
            padding: 8px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
                border: 1px solid #f3f4f6;
            }
            
            /* Header banner styling */
        .full-width-header {
            margin-left: calc(-50vw + 50%);
            margin-right: calc(-50vw + 50%);
            width: 100vw;
        }
        
        .header-banner {
            background: #1e3a8a;
            min-height: 200px;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            padding: 2rem 4rem;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 2;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }
        
        .logo-container {
            flex-shrink: 0;
        }
        
        .hexagon-logo {
            width: 60px;
            height: 60px;
            background: white;
            clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .logo-text {
            font-size: 24px;
            font-weight: bold;
            color: #1e3a8a;
        }
        
        .brand-text {
            color: white;
        }
        
        .brand-title {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 0;
            letter-spacing: 1px;
        }
        
        .brand-tagline {
            font-size: 0.9rem;
            margin: 0.5rem 0 0 0;
            opacity: 0.9;
            letter-spacing: 0.5px;
        }
        
        .header-right {
            flex-shrink: 0;
        }
        
        .brain-graphic {
            width: 200px;
            height: 120px;
        }
        
        .brain-svg {
            width: 100%;
            height: 100%;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));
        }
        
        .city-silhouette {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.3) 0%, transparent 100%);
            clip-path: polygon(
                0% 100%, 5% 80%, 10% 90%, 15% 70%, 20% 85%, 25% 60%, 30% 75%, 35% 50%, 
                40% 65%, 45% 40%, 50% 55%, 55% 30%, 60% 45%, 65% 20%, 70% 35%, 75% 10%, 
                80% 25%, 85% 5%, 90% 15%, 95% 0%, 100% 10%, 100% 100%
            );
        }
        
        /* Responsive styles */
            @media (max-width: 1024px) and (min-width: 641px) {
                .fresh-body td {
                    padding: 8px 8px;
                    height: 54px;
                    min-height: 54px;
                }
                
                .fresh-badge {
                    padding: 5px 10px;
                    letter-spacing: 0.3px;
                }
                
                .fresh-button {
                    padding: 4px;
                }
                
                .fresh-pagination-btn {
                    padding: 8px 16px;
                    font-size: 12px;
                }
                
                .fresh-select {
                    padding: 4px 8px;
                    font-size: 12px;
                }
                
                .fresh-input {
                    border-radius: 8px;
                    padding: 8px 10px;
                }
                
                .fresh-modal-content {
                    border-radius: 14px;
                }
                
                .fresh-collapse {
                    border-radius: 8px;
                    margin: 4px 6px;
                }
                
                .fresh-card {
                    border-radius: 8px;
                    padding: 12px;
                }
            }
            
            @media (max-width: 1024px) {
                .fresh-body td {
                    padding: 10px 12px;
                    height: 58px;
                    min-height: 58px;
                }
                
                /* Hanya kolom aksi yang dibuat vertical */
                .fresh-body td.action-column {
                    padding: 4px 8px !important;
                    vertical-align: top;
                }
                
                .fresh-body td.action-column .flex {
                    flex-direction: column !important;
                    gap: 2px;
                    align-items: center;
                }
                
                .fresh-body td.action-column .fresh-button {
                    padding: 3px 6px !important;
                    font-size: 0.65rem !important;
                    margin: 0 !important;
                    min-width: auto;
                    width: 100%;
                    max-width: 60px;
                }
                
                .fresh-badge {
                    padding: 6px 12px;
                    letter-spacing: 0.3px;
                }
                
                .fresh-button {
                    padding: 5px;
                }
                
                .fresh-pagination-btn {
                    padding: 10px 20px;
                    font-size: 12px;
                }
                
                .fresh-select {
                    padding: 6px 10px;
                    font-size: 12px;
                }
                
                .fresh-input {
                    border-radius: 10px;
                    padding: 10px 12px;
                }
                
                .fresh-modal-content {
                    border-radius: 16px;
                }
                
                .fresh-collapse {
                    border-radius: 10px;
                    margin: 6px 8px;
                }
                
                .fresh-card {
                    border-radius: 10px;
                    padding: 16px;
                }
            }
            

            
            /* Remove border radius from all elements */
            select, input {
                border-radius: 0 !important;
            }
            

    </style>
</head>
<body class="antialiased text-gray-800" style="max-width: 1600px; margin: 0 auto;">



    <!-- Header -->
    <header class="text-center py-4 bg-white border-b border-gray-200">
        <div class="container mx-auto px-4">
            <h1 class="text-xl sm:text-2xl md:text-3xl font-bold mb-1 tracking-wider text-gray-800 flex items-center justify-center gap-2">
                <img src="img.png" alt="Logo Pustakana" class="inline-block w-8 h-8 sm:w-10 sm:h-10 align-middle" style="margin-right: 8px;">
                Pustakana Research Tracing
            </h1>
        </div>
    </header>

    <div class="container mx-auto p-2 sm:p-4 md:p-6 lg:p-8">

        <!-- Filter Section -->
        <div class="filter-section bg-gray-50 rounded-lg p-6 mx-6 mb-6 border border-gray-200">
            <!-- Desktop Filter -->
            <div class="flex flex-col gap-6 sm:gap-8">
                <!-- Search Fields -->
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 sm:gap-8">
                    <div>
                        <label for="id-search" class="block text-xs sm:text-sm font-medium text-gray-700 mb-3">Search ID</label>
                        <input type="text" id="id-search" placeholder="Cari berdasarkan ID" class="filter-select">
                    </div>
                    <div>
                        <label for="title-search" class="block text-xs sm:text-sm font-medium text-gray-700 mb-3">Search Judul</label>
                        <input type="text" id="title-search" placeholder="Cari berdasarkan judul" class="filter-select">
                    </div>
                </div>
                
                <!-- Filter Controls -->
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 sm:gap-8">
                    <!-- Year Filter -->
                    <div>
                        <label for="year-filter" class="block text-xs sm:text-sm font-medium text-gray-700 mb-3">Filter Tahun</label>
                        <select id="year-filter" class="filter-select">
                            <option value="">Semua Tahun</option>
                            <option value="2025">2025</option>
                            <option value="2024">2024</option>
                            <option value="2023">2023</option>
                            <option value="2022">2022</option>
                            <option value="2021">2021</option>
                            <option value="2020">2020</option>
                        </select>
                    </div>
                    
                    <!-- Status Filter -->
                    <div>
                        <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-3">Filter Status</label>
                        <div class="relative">
                            <button id="status-filter-btn" type="button" class="filter-button">
                                <span id="status-filter-text" class="status-text">Semua Status</span>
                                <i class="fas fa-chevron-down text-xs sm:text-sm text-gray-400"></i>
                            </button>
                            <div id="status-filter-dropdown" class="filter-dropdown hidden">
                                <div class="p-3 space-y-1">
                                    <!-- Status checkboxes -->
                                    <label class="flex items-center space-x-3">
                                        <input type="checkbox" value="" class="status-checkbox" checked="">
                                        <span class="text-xs sm:text-sm text-gray-700 font-medium">Semua Status</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="checkbox" value="Writing" class="status-checkbox">
                                        <span class="text-xs sm:text-sm text-gray-700">Writing</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="checkbox" value="Draft" class="status-checkbox">
                                        <span class="text-xs sm:text-sm text-gray-700">Draft</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="checkbox" value="Submit" class="status-checkbox">
                                        <span class="text-xs sm:text-sm text-gray-700">Submit</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="checkbox" value="Review" class="status-checkbox">
                                        <span class="text-xs sm:text-sm text-gray-700">Review</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="checkbox" value="Declined" class="status-checkbox">
                                        <span class="text-xs sm:text-sm text-gray-700">Declined</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="checkbox" value="Accepted" class="status-checkbox">
                                        <span class="text-xs sm:text-sm text-gray-700">Accepted</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="checkbox" value="Published" class="status-checkbox">
                                        <span class="text-xs sm:text-sm text-gray-700">Published</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Accreditation Filter -->
                    <div>
                        <label for="accreditation-filter" class="block text-xs sm:text-sm font-medium text-gray-700 mb-3">Filter Akreditasi</label>
                        <select id="accreditation-filter" class="filter-select">
                            <option value="">Semua Akreditasi</option>
                            <option value="SINTA 1">Sinta 1</option>
                            <option value="SINTA 2">Sinta 2</option>
                            <option value="SINTA 3">Sinta 3</option>
                            <option value="SINTA 4">Sinta 4</option>
                            <option value="Q1">Q1</option>
                            <option value="Q2">Q2</option>
                            <option value="Q3">Q3</option>
                            <option value="Q4">Q4</option>
                        </select>
                    </div>
                    
                </div>
            </div>
        </div>
        
        

        <!-- Main Content: Table -->
        </div>
        
        <div class="bg-white shadow-lg overflow-hidden p-3 mx-4">
            <div class="p-2">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-1 sm:gap-2 mb-2 sm:mb-3">
                    <h2 class="text-sm sm:text-base md:text-lg font-semibold">Research List</h2>
                    <div class="flex gap-2">
                        <button id="add-research-btn" class="btn-transition w-full sm:w-auto inline-flex items-center justify-center px-1.5 py-1 sm:px-2 sm:py-1.5 text-xs font-medium text-indigo-600 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            <i class="fas fa-plus mr-1 sm:mr-1.5 text-xs"></i>
                            <span class="inline">Tambah Penelitian Baru</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="pb-2">
                <div class="table_component" role="region" tabindex="0">
                    <table class="w-full fresh-table fixed-table">
                        <thead class="fresh-header">
                            <tr class="bg-gray-50">
                                <th scope="col" class="px-4 py-3 text-xs font-semibold text-gray-700 text-center border-b border-gray-200">ID</th>
                                <th scope="col" class="px-4 py-3 text-xs font-semibold text-gray-700 border-b border-gray-200">Judul</th>
                                <th scope="col" class="px-4 py-3 text-xs font-semibold text-gray-700 text-center border-b border-gray-200">Tahun Penelitian</th>
                                <th scope="col" class="px-4 py-3 text-xs font-semibold text-gray-700 text-center border-b border-gray-200">Status</th>
                                <th scope="col" class="px-4 py-3 text-xs font-semibold text-gray-700 text-center border-b border-gray-200">Akreditasi</th>
                                <th scope="col" class="px-4 py-3 text-xs font-semibold text-gray-700 text-center border-b border-gray-200">Aksi</th>
                            </tr>
                        </thead>
                                             <tbody id="research-table-body" class="fresh-body">
                         <!-- Data akan diisi oleh JavaScript -->
                         <!-- No data message (hidden by default) -->
                         <tr class="table-row no-data-row hidden">
                             <td colspan="6" class="px-6 py-8 text-center text-gray-400">
                                 <p id="no-data-message" class="text-xs text-gray-400">Data tidak ditemukan</p>
                             </td>
                         </tr>
                     </tbody>
                    </table>
                </div>
                </div>
                
                <!-- Pagination Navigation -->
                <div id="pagination-container" class="mt-3 flex flex-col sm:flex-row items-center justify-between gap-3 bg-gray-50 p-3 rounded-lg border">
                    <!-- Info Halaman -->
                    <div class="text-xs text-gray-600 font-medium">
                        <span id="page-info">Menampilkan 1-10 dari 17 data</span>
                    </div>
                    
                    <!-- Navigasi Halaman -->
                    <div class="flex items-center gap-1">
                        <!-- Tombol Previous -->
                        <button id="prev-page" class="fresh-pagination-btn disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                            <i class="fas fa-chevron-left text-xs"></i>
                        <span class="inline ml-1 text-xs">Prev</span>
                        </button>
                        
                        <!-- Nomor Halaman -->
                        <div id="page-numbers" class="flex items-center gap-1">
                            <!-- Nomor halaman akan di-generate di sini -->
                        </div>
                        
                        <!-- Tombol Next -->
                        <button id="next-page" class="fresh-pagination-btn disabled:opacity-50 disabled:cursor-not-allowed">
                        <span class="inline mr-1 text-xs">Next</span>
                            <i class="fas fa-chevron-right text-xs"></i>
                        </button>
                    </div>
                    
                    <!-- Dropdown Items per Page -->
                    <div class="flex items-center gap-1">
                        <label class="text-xs text-gray-600 font-medium whitespace-nowrap">Per halaman:</label>
                        <select id="items-per-page" class="fresh-select" style="width: 60px !important; min-width: 60px !important; max-width: 60px !important;">
                            <option value="5">5</option>
                            <option value="10" selected>10</option>
                            <option value="15">15</option>
                            <option value="20">20</option>
                            <option value="25">25</option>
                        </select>
                </div>
            </div>
        </div>
        
        <!-- Add/Edit Research Modal -->
        <div id="researchModal" class="modal fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden" style="z-index: 9999;">
            <div class="flex items-center justify-center min-h-screen p-2 sm:p-4">
                <div class="relative w-full max-w-3xl p-3 sm:p-4 border shadow-lg rounded-md bg-white modal-content">
                    <div class="flex justify-between items-center pb-2 border-b">
                        <h3 id="modal-title" class="text-base sm:text-lg font-semibold text-gray-900">Tambah Penelitian Baru</h3>
                        <button id="closeResearchModal" class="btn-transition text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="mt-4">
                        <form id="research-form" class="space-y-3">
                            <input type="hidden" id="edit-key" name="edit-key">
                            <div class="grid grid-cols-1 gap-3 sm:gap-3 md:grid-cols-2 md:gap-3">
                                <div>
                                    <label for="research_id" class="block text-xs font-medium text-gray-700">ID Penelitian</label>
                                    <input type="text" id="research_id" name="research_id" required class="mt-1 block w-full px-2 py-1.5 bg-white border border-gray-300 rounded text-xs focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="4453" maxlength="4" pattern="[0-9]{4}">
                                </div>
                                <div>
                                 <label for="title" class="block text-xs font-medium text-gray-700">Judul Penelitian</label>
                                 <input type="text" id="title" name="title" required class="mt-1 block w-full px-2 py-1.5 bg-white border border-gray-300 rounded text-xs focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                </div>
                                                                                            <div>
                                    <label for="status" class="block text-xs font-medium text-gray-700">Status</label>
                                    <select id="status" name="status" class="mt-1 block w-full px-2 py-1.5 bg-white border border-gray-300 rounded text-xs focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                        <option value="">Pilih Status</option>
                                        <option value="Writing">Writing</option>
                                        <option value="Draft">Draft</option>
                                        <option value="Submit">Submit</option>
                                        <option value="Review">Review</option>
                                        <option value="Declined">Declined</option>
                                        <option value="Accepted">Accepted</option>
                                        <option value="Published">Published</option>
                                    </select>
                             </div>
                                                                                          <div>
                                    <label for="accreditation" class="block text-xs font-medium text-gray-700">Akreditasi</label>
                                    <select id="accreditation" name="accreditation" class="mt-1 block w-full px-2 py-1.5 bg-white border border-gray-300 rounded text-xs focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                        <option value="">Pilih Akreditasi</option>
                                        <optgroup label="Sinta">
                            <option value="SINTA 1">Sinta 1</option>
                            <option value="SINTA 2">Sinta 2</option>
                            <option value="SINTA 3">Sinta 3</option>
                            <option value="SINTA 4">Sinta 4</option>
                        </optgroup>
                                        <optgroup label="Quartile">
                                            <option value="Q1">Q1</option>
                                            <option value="Q2">Q2</option>
                                            <option value="Q3">Q3</option>
                                            <option value="Q4">Q4</option>
                                        </optgroup>
                                  </select>
                              </div>
                                                          <div>
                                  <label for="implementation_year" class="block text-xs font-medium text-gray-700">Tahun Implementasi</label>
                                  <select id="implementation_year" name="implementation_year" required class="mt-1 block w-full px-2 py-1.5 bg-white border border-gray-300 rounded text-xs focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                     <option value="">Pilih Tahun</option>
                                     <option value="2025">2025</option>
                                     <option value="2024">2024</option>
                                     <option value="2023">2023</option>
                                     <option value="2022">2022</option>
                                     <option value="2021">2021</option>
                                 </select>
                             </div>
                            <div id="journal-link-container">
                                <label for="journal_link" class="block text-xs font-medium text-gray-700">Link Jurnal</label>
                                <input type="url" id="journal_link" name="journal_link" class="mt-1 block w-full px-2 py-1.5 bg-white border border-gray-300 rounded text-xs focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="https://...">
                            </div>
                            <div>
                                <label for="doc_link" class="block text-xs font-medium text-gray-700">Link Dokumen</label>
                                <input type="url" id="doc_link" name="doc_link" class="mt-1 block w-full px-2 py-1.5 bg-white border border-gray-300 rounded text-xs focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="https://drive.google.com/...">
                            </div>
                                                         <div id="year-published-container" class="hidden">
                                 <label for="year_published" class="block text-xs font-medium text-gray-700">Tahun Publikasi</label>
                                 <select id="year_published" name="year_published" class="mt-1 block w-full px-2 py-1.5 bg-white border border-gray-300 rounded text-xs focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                     <option value="">Pilih Tahun</option>
                                     <option value="2025">2025</option>
                                     <option value="2024">2024</option>
                                     <option value="2023">2023</option>
                                     <option value="2022">2022</option>
                                     <option value="2021">2021</option>
                                     <option value="2020">2020</option>
                                 </select>
                             </div>
                            <div id="published-link-container" class="hidden">
                                <label for="published_link" class="block text-xs font-medium text-gray-700">Link Publikasi</label>
                                <input type="url" id="published_link" name="published_link" class="mt-1 block w-full px-2 py-1.5 bg-white border border-gray-300 rounded text-xs focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="https://journal.com/...">
                            </div>
                            <div>
                                <label for="notes" class="block text-xs font-medium text-gray-700">Catatan</label>
                                <textarea id="notes" name="notes" rows="3" class="mt-1 block w-full px-2 py-1.5 bg-white border border-gray-300 rounded text-xs focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="Catatan tambahan (opsional)"></textarea>
                            </div>
                        </div>
                        <div class="flex flex-col sm:flex-row justify-end gap-2 sm:gap-3 pt-3 border-t">
                            <button type="button" id="cancel-btn" class="btn-transition w-full sm:w-auto inline-flex items-center justify-center px-3 py-2 sm:py-1.5 border border-red-300 text-xs font-medium text-red-700 bg-red-50 hover:bg-red-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                                Batal
                            </button>
                            <button type="submit" id="submit-btn" class="btn-transition w-full sm:w-auto inline-flex items-center justify-center px-3 py-2 sm:py-1.5 border border-transparent text-xs font-medium shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                Tambah Penelitian
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        

    </div>

    <!-- Modal for Details -->
    <div id="detailModal" class="modal fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
        <div class="relative top-10 sm:top-20 mx-auto p-3 sm:p-5 border w-full max-w-2xl shadow-lg rounded-md bg-white">
            <div class="flex justify-between items-center pb-3 border-b">
                <h3 class="text-xl sm:text-2xl font-bold text-gray-900">Research Details</h3>
                <button id="closeDetailModal" class="btn-transition text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times fa-lg"></i>
                </button>
            </div>
            <div class="mt-3">
                <pre id="modal-content" class="bg-gray-100 p-3 sm:p-4 rounded-lg text-xs sm:text-sm whitespace-pre-wrap break-all"></pre>
            </div>
        </div>
    </div>
    







    <!-- Document Preview Modal -->
    <div id="popupOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4" style="display: none;">
        <div id="popup" class="bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[70vh] overflow-hidden relative" style="display: none;">
            <div class="flex justify-between items-center p-3 border-b bg-white">
                <h3 class="text-base font-semibold text-gray-900">Preview Dokumen</h3>
                <button onclick="closePopup()" class="text-gray-400 hover:text-gray-600 transition-colors">
                    <i class="fas fa-times text-lg"></i>
                </button>
            </div>
            <div class="p-1 bg-gray-50 flex justify-center">
                <iframe id="fileIframe" src="" width="80%" height="400px" frameborder="0" class="rounded shadow-sm bg-white"></iframe>
            </div>
        </div>
    </div>

    <!-- PIN Authentication Modal -->
    <div id="pinModal" class="modal fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-2 sm:p-4">
            <div class="relative w-full max-w-md p-3 sm:p-4 border shadow-lg rounded-md bg-white modal-content">
                <div class="flex justify-between items-center pb-2 border-b">
                    <h3 id="pin-modal-title" class="text-sm sm:text-base font-semibold text-gray-900">Verifikasi PIN</h3>
                    <button id="closePinModal" class="btn-transition text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="mt-4">
                    <form id="pin-form" class="space-y-4">
                        <div>
                            <label for="pin-input" class="block text-xs font-medium text-gray-700 mb-2">Masukkan PIN untuk melanjutkan</label>
                            <input type="password" id="pin-input" name="pin" required maxlength="8" class="block w-full px-3 py-2 bg-white border border-gray-300 rounded-md text-xs focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="Masukkan PIN">
                        </div>
                        <div class="flex flex-col sm:flex-row justify-end gap-2 sm:gap-3 pt-3 border-t">
                            <button type="button" id="cancel-pin-btn" class="btn-transition w-full sm:w-auto inline-flex items-center justify-center px-3 py-2 sm:py-1.5 border border-red-300 text-xs font-medium text-red-700 bg-red-50 hover:bg-red-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                                Batal
                            </button>
                            <button type="submit" id="submit-pin-btn" class="btn-transition w-full sm:w-auto inline-flex items-center justify-center px-3 py-2 sm:py-1.5 border border-transparent text-xs font-medium shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                Verifikasi
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>


    <!-- Firebase SDK -->
    <script type="module">
        // Import functions from the Firebase SDKs
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getDatabase, ref, onValue, push, set, update, remove } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCmrsyqCNysU9Y3wGb8hyzPV8kkByzLD5Q",
            authDomain: "data-pustakana.firebaseapp.com",
            databaseURL: "https://data-pustakana-default-rtdb.firebaseio.com",
            projectId: "data-pustakana",
            storageBucket: "data-pustakana.firebasestorage.app",
            messagingSenderId: "1053039020771",
            appId: "1:1053039020771:web:0a90f51f16268e458553d6",
            measurementId: "G-VXVY2WD4HX"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const researchRef = ref(database, 'research');

        // DOM Elements
        const tableBody = document.getElementById('research-table-body');
        
        // Filter elements
        const yearFilter = document.getElementById('year-filter');
        const accreditationFilter = document.getElementById('accreditation-filter');
        const statusFilterBtn = document.getElementById('status-filter-btn');
        const statusFilterDropdown = document.getElementById('status-filter-dropdown');
        const statusFilterText = document.getElementById('status-filter-text');
        const statusCheckboxes = document.querySelectorAll('.status-checkbox');
        
        // Modal elements
        const researchModal = document.getElementById('researchModal');
        const modalTitle = document.getElementById('modal-title');
        const closeResearchModal = document.getElementById('closeResearchModal');
        const addResearchBtn = document.getElementById('add-research-btn');
        const cancelBtn = document.getElementById('cancel-btn');
        



        
        // PIN Modal elements
        const pinModal = document.getElementById('pinModal');
        const pinModalTitle = document.getElementById('pin-modal-title');
        const closePinModal = document.getElementById('closePinModal');
        const cancelPinBtn = document.getElementById('cancel-pin-btn');
        const pinForm = document.getElementById('pin-form');
        const pinInput = document.getElementById('pin-input');
        
                 const researchForm = document.getElementById('research-form');
         const submitBtn = document.getElementById('submit-btn');
         const statusSelect = document.getElementById('status');
         const yearPublishedContainer = document.getElementById('year-published-container');
         const publishedLinkContainer = document.getElementById('published-link-container');
         
         const toast = document.getElementById('toast');
         const toastMessage = document.getElementById('toast-message');

        let allData = {}; // To store the fetched data globally

        let pendingAction = null; // To store pending action after PIN verification
        let pendingActionData = null; // To store data for pending action
        
        // Pagination variables
        let currentPage = 1;
        let itemsPerPage = 10;
        let filteredData = [];
        

        
        // Function to generate random 4-digit research ID
        function generateResearchId() {
            if (!allData || Object.keys(allData).length === 0) {
                return Math.floor(1000 + Math.random() * 9000).toString();
            }
            
            const existingIds = Object.values(allData)
                .filter(item => item && item.research_id)
                .map(item => item.research_id);
            
            // Generate random ID until we find one that doesn't exist
            let newId;
            let attempts = 0;
            const maxAttempts = 100; // Prevent infinite loop
            
            do {
                newId = Math.floor(1000 + Math.random() * 9000).toString();
                attempts++;
            } while (existingIds.includes(newId) && attempts < maxAttempts);
            
            // If we couldn't find a unique ID after max attempts, use timestamp-based ID
            if (attempts >= maxAttempts) {
                const timestamp = Date.now();
                newId = (timestamp % 9000 + 1000).toString();
            }
            
            return newId;
        }
        


        // --- Data Fetching and Table Population ---
        onValue(researchRef, (snapshot) => {
            const data = snapshot.val();
            allData = data; // Store data for later use (edit/delete)
            
            // Reset to first page when data changes
            currentPage = 1;
            
            // Ensure status checkboxes are in valid state
            ensureValidStatusCheckboxState();
            
            // Render table with pagination
            renderTableWithPagination(data);
            return;
                let counter = 1;
                Object.entries(data).forEach(([key, value]) => {
                    const row = document.createElement('tr');
                    row.classList.add('hover:bg-gray-50', 'table-row');
                    
                    row.innerHTML = `
                        <td class="w-12 px-3 py-3 whitespace-nowrap text-xs text-gray-600 border-r border-gray-300">${counter++}</td>
                                            <td class="w-80 px-3 py-3 border-r border-gray-300">
                        <div class="text-xs font-medium text-gray-800 text-wrap">${value.title || 'N/A'}</div>
                    </td>
                        <td class="w-32 px-3 py-3 whitespace-nowrap border-r border-gray-300">
                                                    <span class="accreditation-badge">
                            ${value.status === 'Draft' || value.status === 'Writing' ? 'N/A' : (value.accreditation ? capitalizeAccreditation(value.accreditation) : 'N/A')}
                        </span>
                        </td>
                        <td class="w-32 px-3 py-3 whitespace-nowrap border-r border-gray-300">
                            <span class="status-text">
                                ${value.status || 'N/A'}
                            </span>
                        </td>
                        <td class="w-24 px-3 py-3 whitespace-nowrap text-xs text-gray-600 border-r border-gray-300">${value.implementation_year || 'N/A'}</td>
                                            <td class="w-32 px-3 py-3 whitespace-nowrap text-xs font-medium">
                        <div class="flex items-center justify-center space-x-2">
                            <button data-key="${key}" class="fresh-button view-btn text-gray-500" title="View"><i class="fas fa-eye"></i></button>
                            <button data-key="${key}" class="fresh-button edit-btn text-gray-500" title="Edit"><i class="fas fa-pencil-alt"></i></button>
                            <button data-key="${key}" class="fresh-button delete-btn text-gray-500" title="Delete"><i class="fas fa-trash"></i></button>
                        </div>
                        </td>
                    `;
                    tableBody.appendChild(row);
                    
                    // Add collapse row for details
                    const collapseRow = document.createElement('tr');
                    collapseRow.id = `collapse-${key}`;
                    collapseRow.classList.add('hidden', 'bg-gray-50', 'collapse-transition');
                    collapseRow.innerHTML = `
                        <td colspan="6" class="px-6 py-4">
                        <div class="border border-gray-300 p-4 bg-gray-100">
                                <div class="space-y-4">
                                <div class="border border-gray-300 p-3 bg-gray-50">
                                    <h4 class="text-sm font-semibold text-gray-700 mb-2">Detail Penelitian</h4>
                                            <div class="space-y-2 text-xs">
                                                                    <div class="flex flex-wrap gap-2">
                                <div class="border border-gray-300 px-3 py-1.5 bg-gray-100">
                                    <div class="flex items-center">
                                        <span class="font-medium text-gray-600">Akreditasi:</span>
                                        <span class="text-gray-700 ml-2">${value.accreditation || 'N/A'}</span>
                                            </div>
                                        </div>
                                <div class="border border-gray-300 px-3 py-1.5 bg-gray-100">
                                    <div class="flex items-center">
                                        <span class="font-medium text-gray-600">Link Jurnal:</span>
                                        ${value.journal_link ? `<a href="${value.journal_link}" target="_blank" class="text-blue-600 hover:text-blue-800 hover:underline ml-2">Disini</a>` : '<span class="text-gray-700 ml-2">-</span>'}
                                    </div>
                                </div>
                                <div class="border border-gray-300 px-3 py-1.5 bg-gray-100">
                                    <div class="flex items-center">
                                        <span class="font-medium text-gray-600">Link Dokumen:</span>
                                        ${value.doc_link ? `<button onclick="generateEmbed('${value.doc_link}')" class="text-blue-600 hover:text-blue-800 hover:underline ml-2 cursor-pointer">Preview</button>` : '<span class="text-gray-700 ml-2">-</span>'}
                                    </div>
                                </div>
                                <div class="border border-gray-300 px-3 py-1.5 bg-gray-100">
                                    <div class="flex items-center">
                                        <span class="font-medium text-gray-600">Tahun Publikasi:</span>
                                        <span class="text-gray-700 ml-2">${value.published?.year_published || '-'}</span>
                                    </div>
                                </div>
                                <div class="border border-gray-300 px-3 py-1.5 bg-gray-100">
                                    <div class="flex items-center">
                                        <span class="font-medium text-gray-600">Link Publikasi:</span>
                                        ${value.published?.published_link ? `<a href="${value.published.published_link}" target="_blank" class="text-blue-600 hover:text-blue-800 hover:underline ml-2">Disini</a>` : '<span class="text-gray-700 ml-2">-</span>'}
                                    </div>
                                </div>
                            </div>
                                    </div>
                                </div>
                            </div>
                        </td>
                    `;
                    tableBody.appendChild(collapseRow);
                });

        });

        // --- Event Delegation for Table Actions ---
        
        // Initialize status checkboxes on page load
        document.addEventListener('DOMContentLoaded', () => {
            ensureValidStatusCheckboxState();
        });
        
        tableBody.addEventListener('click', (e) => {
            const targetButton = e.target.closest('button');
            if (!targetButton) return;

            const key = targetButton.dataset.key;
            if (targetButton.classList.contains('view-btn')) {
                toggleCollapse(key);
            } else if (targetButton.classList.contains('edit-btn') || targetButton.classList.contains('edit-inline-btn')) {
                requirePinAuth('edit', key, allData[key]);
            } else if (targetButton.classList.contains('delete-btn')) {
                requirePinAuth('delete', key);
            } else if (targetButton.classList.contains('close-collapse-btn')) {
                hideCollapse(key);
            }
        });

        // --- Filter Event Listeners ---
        yearFilter.addEventListener('change', applyFilters);
        accreditationFilter.addEventListener('change', applyFilters);
        statusFilterBtn.addEventListener('click', toggleStatusDropdown);
        
        
        
        
        
        // Status filter dropdown functionality - Sederhana dan efektif
        statusCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', (e) => {
                // Then handle the change
                handleStatusCheckboxChange.call(e.target);
            });
        });
        
        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            if (!statusFilterBtn.contains(e.target) && !statusFilterDropdown.contains(e.target)) {
                statusFilterDropdown.classList.add('hidden');
            }
        });

                 // --- Modal Functionality ---
         
                 // Status change handler for year published, published link, and journal link visibility
        statusSelect.addEventListener('change', function() {
            const journalLinkContainer = document.getElementById('journal-link-container');
            const accreditationField = document.getElementById('accreditation');
            
            if (this.value === 'Published') {
                yearPublishedContainer.classList.remove('hidden');
                publishedLinkContainer.classList.remove('hidden');
                journalLinkContainer.classList.remove('hidden');
                    // Tampilkan field Akreditasi jika status Published
                    accreditationField.parentElement.classList.remove('hidden');
                // Akreditasi wajib jika status Published
                accreditationField.required = true;
                accreditationField.classList.add('border-red-300');
            } else if (this.value === 'Draft' || this.value === 'Writing' || this.value === 'Declined') {
                yearPublishedContainer.classList.add('hidden');
                publishedLinkContainer.classList.add('hidden');
                journalLinkContainer.classList.add('hidden');
                    // Sembunyikan field Akreditasi jika status Draft atau Declined
                    accreditationField.parentElement.classList.add('hidden');
                // Akreditasi tidak wajib jika status Draft atau Declined
                accreditationField.required = false;
                accreditationField.classList.remove('border-red-300');
                    // Reset values when status is Draft atau Declined
                document.getElementById('year_published').value = '';
                document.getElementById('published_link').value = '';
                document.getElementById('journal_link').value = '';
                document.getElementById('accreditation').value = '';
            } else {
                yearPublishedContainer.classList.add('hidden');
                publishedLinkContainer.classList.add('hidden');
                journalLinkContainer.classList.remove('hidden');
                    // Tampilkan field Akreditasi untuk status lain (Submit, Review, Accepted)
                    accreditationField.parentElement.classList.remove('hidden');
                // Akreditasi wajib untuk status lain (Submit, Review, Accepted)
                accreditationField.required = true;
                accreditationField.classList.add('border-red-300');
                // Reset year published and published link values when status is not Published
                document.getElementById('year_published').value = '';
                document.getElementById('published_link').value = '';
            }
        });
        

         
                           // Add Research Modal
        addResearchBtn.addEventListener('click', () => {
            requirePinAuth('add');
        });
        

        

        
        closeResearchModal.addEventListener('click', hideResearchModal);
        cancelBtn.addEventListener('click', hideResearchModal);
        
        // Close modal when clicking outside
        researchModal.addEventListener('click', (e) => {
            if (e.target === researchModal) {
                hideResearchModal();
            }
        });

        // PIN Modal Event Listeners
        closePinModal.addEventListener('click', hidePinModal);
        cancelPinBtn.addEventListener('click', hidePinModal);
        
        // Close PIN modal when clicking outside
        pinModal.addEventListener('click', (e) => {
            if (e.target === pinModal) {
                hidePinModal();
            }
        });
        


        // PIN Form Submit
        pinForm.addEventListener('submit', handlePinSubmit);
        
        // --- Pagination Event Listeners ---
        document.getElementById('prev-page').addEventListener('click', goToPreviousPage);
        document.getElementById('next-page').addEventListener('click', goToNextPage);
        document.getElementById('items-per-page').addEventListener('change', (e) => {
            changeItemsPerPage(e.target.value);
        });
        
        // --- Search Event Listeners ---
        setupSearchListeners();
        

        
                // --- PIN Authentication Functions ---
        // Secure hash function using Web Crypto API
        async function secureHash(str) {
            const encoder = new TextEncoder();
            const data = encoder.encode(str);
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
            return hashHex;
        }

        // Fallback simple hash function (for compatibility)
        function simpleHash(str) {
            let hash = 0;
            if (str.length === 0) return hash;
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash; // Convert to 32bit integer
            }
            return Math.abs(hash).toString();
        }

        // Generate a random salt for additional security
        function generateSalt(length = 16) {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            let result = '';
            for (let i = 0; i < length; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        // Hash with salt for enhanced security
        async function hashWithSalt(str, salt = null) {
            if (!salt) {
                salt = generateSalt();
            }
            const saltedString = str + salt;
            const hash = await secureHash(saltedString);
            return { hash, salt };
        }

        // Verify hash with salt
        async function verifyHashWithSalt(str, hash, salt) {
            const { hash: computedHash } = await hashWithSalt(str, salt);
            return computedHash === hash;
        }

        // Simple MD5-like hash (for non-cryptographic purposes)
        function simpleMD5(str) {
            function md5cycle(x, k) {
                var a = x[0], b = x[1], c = x[2], d = x[3];
                a = ff(a, b, c, d, k[0], 7, -680876936);
                d = ff(d, a, b, c, k[1], 12, -389564586);
                c = ff(c, d, a, b, k[2], 17, 606105819);
                b = ff(b, c, d, a, k[3], 22, -1044525330);
                a = ff(a, b, c, d, k[4], 7, -176418897);
                d = ff(d, a, b, c, k[5], 12, 1200080426);
                c = ff(c, d, a, b, k[6], 17, -1473231341);
                b = ff(b, c, d, a, k[7], 22, -45705983);
                a = ff(a, b, c, d, k[8], 7, 1770035416);
                d = ff(d, a, b, c, k[9], 12, -1958414417);
                c = ff(c, d, a, b, k[10], 17, -42063);
                b = ff(b, c, d, a, k[11], 22, -1990404162);
                a = ff(a, b, c, d, k[12], 7, 1804603682);
                d = ff(d, a, b, c, k[13], 12, -40341101);
                c = ff(c, d, a, b, k[14], 17, -1502002290);
                b = ff(b, c, d, a, k[15], 22, 1236535329);
                a = gg(a, b, c, d, k[1], 5, -165796510);
                d = gg(d, a, b, c, k[6], 9, -1069501632);
                c = gg(c, d, a, b, k[11], 14, 643717713);
                b = gg(b, c, d, a, k[0], 20, -373897302);
                a = gg(a, b, c, d, k[5], 5, -701558691);
                d = gg(d, a, b, c, k[10], 9, 38016083);
                c = gg(c, d, a, b, k[15], 14, -660478335);
                b = gg(b, c, d, a, k[4], 20, -405537848);
                a = gg(a, b, c, d, k[9], 5, 568446438);
                d = gg(d, a, b, c, k[14], 9, -1019803690);
                c = gg(c, d, a, b, k[3], 14, -187363961);
                b = gg(b, c, d, a, k[8], 20, 1163531501);
                a = gg(a, b, c, d, k[13], 5, -1444681467);
                d = gg(d, a, b, c, k[2], 9, -51403784);
                c = gg(c, d, a, b, k[7], 14, 1735328473);
                b = gg(b, c, d, a, k[12], 20, -1926607734);
                a = hh(a, b, c, d, k[5], 4, -378558);
                d = hh(d, a, b, c, k[8], 11, -2022574463);
                c = hh(c, d, a, b, k[11], 16, 1839030562);
                b = hh(b, c, d, a, k[14], 23, -35309556);
                a = hh(a, b, c, d, k[1], 4, -1530992060);
                d = hh(d, a, b, c, k[4], 11, 1272893353);
                c = hh(c, d, a, b, k[7], 16, -155497632);
                b = hh(b, c, d, a, k[10], 23, -1094730640);
                a = hh(a, b, c, d, k[13], 4, 681279174);
                d = hh(d, a, b, c, k[0], 11, -358537222);
                c = hh(c, d, a, b, k[3], 16, -722521979);
                b = hh(b, c, d, a, k[6], 23, 76029189);
                a = hh(a, b, c, d, k[9], 4, -640364487);
                d = hh(d, a, b, c, k[12], 11, -421815835);
                c = hh(c, d, a, b, k[15], 16, 530742520);
                b = hh(b, c, d, a, k[2], 23, -995338651);
                a = ii(a, b, c, d, k[0], 6, -198630844);
                d = ii(d, a, b, c, k[7], 10, 1126891415);
                c = ii(c, d, a, b, k[14], 15, -1416354905);
                b = ii(b, c, d, a, k[5], 21, -57434055);
                a = ii(a, b, c, d, k[12], 6, 1700485571);
                d = ii(d, a, b, c, k[3], 10, -1894986606);
                c = ii(c, d, a, b, k[10], 15, -1051523);
                b = ii(b, c, d, a, k[1], 21, -2054922799);
                a = ii(a, b, c, d, k[8], 6, 1873313359);
                d = ii(d, a, b, c, k[15], 10, -30611744);
                c = ii(c, d, a, b, k[6], 15, -1560198380);
                b = ii(b, c, d, a, k[13], 21, 1309151649);
                a = ii(a, b, c, d, k[4], 6, -145523070);
                d = ii(d, a, b, c, k[11], 10, -1120210379);
                c = ii(c, d, a, b, k[2], 15, 718787259);
                b = ii(b, c, d, a, k[9], 21, -343485551);
                x[0] = add32(a, x[0]);
                x[1] = add32(b, x[1]);
                x[2] = add32(c, x[2]);
                x[3] = add32(d, x[3]);
            }
            function cmn(q, a, b, x, s, t) {
                a = add32(add32(a, q), add32(x, t));
                return add32((a << s) | (a >>> (32 - s)), b);
            }
            function ff(a, b, c, d, x, s, t) {
                return cmn((b & c) | ((~b) & d), a, b, x, s, t);
            }
            function gg(a, b, c, d, x, s, t) {
                return cmn((b & d) | (c & (~d)), a, b, x, s, t);
            }
            function hh(a, b, c, d, x, s, t) {
                return cmn(b ^ c ^ d, a, b, x, s, t);
            }
            function ii(a, b, c, d, x, s, t) {
                return cmn(c ^ (b | (~d)), a, b, x, s, t);
            }
            function md51(s) {
                var n = s.length,
                    state = [1732584193, -271733879, -1732584194, 271733878], i;
                for (i = 64; i <= s.length; i += 64) {
                    md5cycle(state, md5blk(s.substring(i - 64, i)));
                }
                s = s.substring(i - 64);
                var tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
                for (i = 0; i < s.length; i++)
                    tail[i >> 2] |= s.charCodeAt(i) << ((i % 4) << 3);
                tail[i >> 2] |= 0x80 << ((i % 4) << 3);
                if (i > 55) {
                    md5cycle(state, tail);
                    for (i = 0; i < 16; i++) tail[i] = 0;
                }
                tail[14] = n * 8;
                md5cycle(state, tail);
                return state;
            }
            function md5blk(s) {
                var md5blks = [], i;
                for (i = 0; i < 64; i += 4) {
                    md5blks[i >> 2] = s.charCodeAt(i)
                        + (s.charCodeAt(i + 1) << 8)
                        + (s.charCodeAt(i + 2) << 16)
                        + (s.charCodeAt(i + 3) << 24);
                }
                return md5blks;
            }
            var hex_chr = '0123456789abcdef'.split('');
            function rhex(n) {
                var s = '', j = 0;
                for (; j < 4; j++)
                    s += hex_chr[(n >> (j * 8 + 4)) & 0x0F]
                        + hex_chr[(n >> (j * 8)) & 0x0F];
                return s;
            }
            function hex(x) {
                for (var i = 0; i < x.length; i++)
                    x[i] = rhex(x[i]);
                return x.join('');
            }
            function add32(a, b) {
                return (a + b) & 0xFFFFFFFF;
            }
            return hex(md51(str));
        }

        // Utility functions for common hashing needs
        const HashUtils = {
            // Quick hash for simple checksums
            quickHash: function(str) {
                return simpleHash(str);
            },

            // Secure hash for passwords/sensitive data
            secureHash: async function(str) {
                return await secureHash(str);
            },

            // Hash with salt for enhanced security
            hashWithSalt: async function(str, salt = null) {
                return await hashWithSalt(str, salt);
            },

            // Verify hash with salt
            verifyWithSalt: async function(str, hash, salt) {
                return await verifyHashWithSalt(str, hash, salt);
            },

            // Generate unique ID based on content
            generateContentId: async function(content) {
                const timestamp = Date.now().toString();
                const contentHash = await secureHash(content + timestamp);
                return contentHash.substring(0, 16); // Return first 16 characters
            },

            // Hash file content (for file integrity checking)
            hashFileContent: async function(fileContent) {
                return await secureHash(fileContent);
            },

            // Create checksum for data validation
            createChecksum: async function(data) {
                const jsonString = JSON.stringify(data);
                return await secureHash(jsonString);
            },

            // Verify data integrity
            verifyChecksum: async function(data, expectedChecksum) {
                const actualChecksum = await this.createChecksum(data);
                return actualChecksum === expectedChecksum;
            }
        };

        // Example usage functions
        async function demonstrateHashing() {
            console.log('=== Demonstrasi Fungsi Hashing ===');
            
            const testString = 'Hello World';
            
            // Simple hash
            const simpleHashResult = HashUtils.quickHash(testString);
            console.log('Simple Hash:', simpleHashResult);
            
            // Secure hash
            const secureHashResult = await HashUtils.secureHash(testString);
            console.log('Secure Hash:', secureHashResult);
            
            // Hash with salt
            const { hash: saltedHash, salt } = await HashUtils.hashWithSalt(testString);
            console.log('Salted Hash:', saltedHash);
            console.log('Salt:', salt);
            
            // Verify salted hash
            const isValid = await HashUtils.verifyWithSalt(testString, saltedHash, salt);
            console.log('Verification Result:', isValid);
            
            // Generate content ID
            const contentId = await HashUtils.generateContentId(testString);
            console.log('Content ID:', contentId);
        }

        // Uncomment the line below to run demonstration
        // demonstrateHashing();

        function requirePinAuth(action, key = null, data = null) {
            // Set pending action BEFORE showing modal
            pendingAction = action;
            pendingActionData = { key, data };

            // Set modal title based on action
            switch (action) {
                case 'add':
                    pinModalTitle.textContent = 'Verifikasi PIN';
                    break;
                case 'edit':
                    pinModalTitle.textContent = 'Verifikasi PIN';
                    break;
                case 'delete':
                    pinModalTitle.textContent = 'Verifikasi PIN';
                    break;

            }
            
            // Show PIN modal
            pinModal.classList.remove('hidden');
            pinInput.focus();
            pinInput.value = '';
        }

        function hidePinModal() {
            pinModal.classList.add('hidden');
            
            // DON'T reset these variables here - they're needed for executePendingAction
            // pendingAction = null;
            // pendingActionData = null;
            
            pinInput.value = '';
        }

        async function handlePinSubmit(e) {
            e.preventDefault();
            const enteredPin = pinInput.value;
            
            try {
                // Hash the entered PIN using secure hash function
                const enteredPinHash = await secureHash(enteredPin);
                const correctPinHash = await secureHash('0000'); // Hash of correct PIN
            
            if (enteredPinHash === correctPinHash) {
                // PIN is correct, proceed with action
                hidePinModal();
                executePendingAction();
            } else {
                // PIN is incorrect
                console.log('PIN salah! Silakan coba lagi.');
                pinInput.value = '';
                pinInput.focus();
                }
            } catch (error) {
                console.error('Error during PIN verification:', error);
                // Fallback to simple hash if Web Crypto API fails
                const enteredPinHash = simpleHash(enteredPin);
                const correctPinHash = simpleHash('0000');
                
                if (enteredPinHash === correctPinHash) {
                    hidePinModal();
                    executePendingAction();
                } else {
                    console.log('PIN salah! Silakan coba lagi.');
                    pinInput.value = '';
                    pinInput.focus();
                }
            }
        }



        function executePendingAction() {
            if (!pendingAction) {
                return;
            }
            
            switch (pendingAction) {
                case 'add':
                    showResearchModal('add');
                    break;
                case 'edit':
                    showResearchModal('edit', pendingActionData.key, pendingActionData.data);
                    break;
                case 'delete':
                    // Langsung hapus data tanpa konfirmasi
                    const itemRef = ref(database, 'research/' + pendingActionData.key);
                    remove(itemRef)
                        .then(() => {
                            showToast('Research deleted successfully.', 'success');
                            setTimeout(() => {
                            loadResearchData();
                            }, 100);
                        })
                        .catch((error) => {
                            console.error("Error deleting document: ", error);
                            showToast('Error deleting research.', 'error');
                        });
                    break;

            }
            
            // Clear pending action
            pendingAction = null;
            pendingActionData = null;
        }

        function showResearchModal(mode, key = null, data = null) {
            if (mode === 'add') {
                modalTitle.textContent = 'Tambah Penelitian Baru';
                submitBtn.textContent = 'Tambah Penelitian';
                submitBtn.className = 'inline-flex justify-center py-1.5 px-3 border border-transparent shadow-sm text-xs font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500';
                resetFormToDefault();
                // Auto-fill research_id for new research
                document.getElementById('research_id').value = generateResearchId();
            } else if (mode === 'edit') {
                modalTitle.textContent = 'Edit Penelitian';
                submitBtn.textContent = 'Update Penelitian';
                submitBtn.className = 'inline-flex justify-center py-1.5 px-3 border border-transparent shadow-sm text-xs font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500';
                setupEditForm(key, data);
            }
            
            if (researchModal) {
                researchModal.classList.remove('hidden');
            }
        }
        
        function hideResearchModal() {
            if (researchModal) {
                researchModal.classList.add('hidden');
            }
            resetFormToDefault();
        }





        // --- Form and CRUD Logic ---
                 function setupEditForm(key, data) {
             researchForm.querySelector('#edit-key').value = key;
             researchForm.querySelector('#research_id').value = data.research_id || '';
             researchForm.querySelector('#title').value = data.title || '';
             researchForm.querySelector('#accreditation').value = data.accreditation || '';
             researchForm.querySelector('#status').value = data.status || 'Draft';
             researchForm.querySelector('#implementation_year').value = data.implementation_year || '';
             researchForm.querySelector('#journal_link').value = data.journal_link || '';
             researchForm.querySelector('#doc_link').value = data.doc_link || '';
             researchForm.querySelector('#year_published').value = data.published?.year_published || '';
             researchForm.querySelector('#published_link').value = data.published?.published_link || '';
             researchForm.querySelector('#notes').value = data.notes || '';
             
             // Show/hide year published, published link, and journal link fields based on status
             const journalLinkContainer = document.getElementById('journal-link-container');
             const accreditationField = document.getElementById('accreditation');
             
             if (data.status === 'Published') {
                 yearPublishedContainer.classList.remove('hidden');
                 publishedLinkContainer.classList.remove('hidden');
                 journalLinkContainer.classList.remove('hidden');
                    // Tampilkan field Akreditasi jika status Published
                    accreditationField.parentElement.classList.remove('hidden');
                 accreditationField.required = true;
                 accreditationField.classList.add('border-red-300');
             } else if (data.status === 'Draft' || data.status === 'Writing' || data.status === 'Declined') {
                 yearPublishedContainer.classList.add('hidden');
                 publishedLinkContainer.classList.add('hidden');
                 journalLinkContainer.classList.add('hidden');
                    // Sembunyikan field Akreditasi jika status Draft atau Declined
                    accreditationField.parentElement.classList.add('hidden');
                 accreditationField.required = false;
                 accreditationField.classList.remove('border-red-300');
             } else {
                 yearPublishedContainer.classList.add('hidden');
                 publishedLinkContainer.classList.add('hidden');
                 journalLinkContainer.classList.remove('hidden');
                    // Tampilkan field Akreditasi untuk status lain (Submit, Review, Accepted)
                    accreditationField.parentElement.classList.remove('hidden');
                 accreditationField.required = true;
                 accreditationField.classList.add('border-red-300');
             }
         }

                         function resetFormToDefault() {
            researchForm.reset();
            researchForm.querySelector('#edit-key').value = '';
            researchForm.querySelector('#research_id').value = '';
            researchForm.querySelector('#notes').value = '';
            // Hide year published and published link fields by default
            yearPublishedContainer.classList.add('hidden');
            publishedLinkContainer.classList.add('hidden');
            // Hide journal link field by default (for Writing status)
            document.getElementById('journal-link-container').classList.add('hidden');
            
            // Set default status to Writing and make accreditation not required
            const statusField = document.getElementById('status');
            const accreditationField = document.getElementById('accreditation');
            statusField.value = 'Writing';
                // Sembunyikan field Akreditasi untuk status Writing
                accreditationField.parentElement.classList.add('hidden');
            accreditationField.required = false;
            accreditationField.classList.remove('border-red-300');
            
            // Trigger status change event to update form
            statusField.dispatchEvent(new Event('change'));
        }
        
        researchForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const formData = new FormData(researchForm);
            const key = formData.get('edit-key');
            const researchId = formData.get('research_id');
            
            // Validate research_id format
            if (researchId && !/^\d{4}$/.test(researchId)) {
                                        console.log('ID Penelitian harus berupa 4 digit angka!');
                return;
            }
            
            // Check for duplicate research_id (except current item when editing)
            if (researchId && allData) {
                const duplicateKey = Object.keys(allData).find(k => 
                    allData[k].research_id === researchId && k !== key
                );
                if (duplicateKey) {
                                            console.log('ID Penelitian sudah digunakan!');
                    return;
                }
            }
            
            const status = formData.get('status');
            const researchData = {
                research_id: formData.get('research_id') || (key ? allData[key].research_id : generateResearchId()),
                title: formData.get('title'),
                accreditation: formData.get('accreditation'),
                status: status,
                journal_link: (status === 'Draft' || status === 'Writing' || status === 'Declined') ? '' : formData.get('journal_link'),
                doc_link: formData.get('doc_link'),
                implementation_year: parseInt(formData.get('implementation_year')),
                notes: formData.get('notes') || '',
                published: {
                    year_published: parseInt(formData.get('year_published')) || null,
                    published_link: formData.get('published_link') || ''
                }
            };

            if (key) { // Update existing data
                const itemRef = ref(database, 'research/' + key);
                update(itemRef, researchData)
                    .then(() => {
                        console.log('Penelitian berhasil diperbarui!');
                        hideResearchModal();
                        // Refresh tabel setelah update
                        setTimeout(() => {
                        loadResearchData();
                        }, 100);
                    })
                    .catch((error) => {
                        console.error("Error updating document: ", error);
                        console.log('Error memperbarui penelitian.');
                    });
            } else { // Add new data
                const newResearchRef = push(researchRef);
                set(newResearchRef, researchData)
                    .then(() => {
                        console.log('Penelitian berhasil ditambahkan!');
                        hideResearchModal();
                        // Refresh tabel setelah tambah data baru
                        setTimeout(() => {
                        loadResearchData();
                        }, 100);
                    })
                    .catch((error) => {
                        console.error("Error adding document: ", error);
                        console.log('Error menambahkan penelitian.');
                    });
            }
        });


        
        // --- Helper Functions ---
        function getStatusColor(status) {
            switch (status) {
                case 'Draft': return 'fresh-badge draft';
                case 'Submit': return 'fresh-badge submit';
                case 'Review': return 'fresh-badge review';
                case 'Declined': return 'fresh-badge declined';
                case 'Accepted': return 'fresh-badge accepted';
                case 'Published': return 'fresh-badge published';
                default: return 'fresh-badge draft';
            }
        }

        function capitalizeAccreditation(accreditation) {
            if (!accreditation || accreditation === 'N/A') return 'N/A';
            
            // Handle SINTA format
            if (accreditation.startsWith('SINTA')) {
                return 'Sinta ' + accreditation.substring(6);
            }
            
            // Handle other formats (Q1, Q2, Q3, Q4, A, B, C)
            return accreditation.charAt(0) + accreditation.substring(1).toLowerCase();
        }
        

        


        // --- Filter Functions ---
        
        // Function to ensure status checkboxes are in a reasonable initial state
        function ensureValidStatusCheckboxState() {
            const allCheckbox = document.querySelector('.status-checkbox[value=""]');
            const otherCheckboxes = document.querySelectorAll('.status-checkbox:not([value=""])');
            
            
            // Only set initial state if no checkbox is selected
            const hasSelectedStatus = Array.from(otherCheckboxes).some(cb => cb.checked);
            
            // If no individual status is selected and "Semua Status" is not checked, check "Semua Status"
            if (!hasSelectedStatus && allCheckbox && !allCheckbox.checked) {
                allCheckbox.checked = true;
            }
            
            // Update filter text
            updateStatusFilterText();
            
            
        }
        
        function applyFilters() {
            // Reset to first page when filtering
            currentPage = 1;
            
            // Get current search terms
            const idSearchTerm = document.getElementById('id-search').value.toLowerCase().trim();
            const titleSearchTerm = document.getElementById('title-search').value.toLowerCase().trim();
            
            // Get filter values
            const yearFilterValue = document.getElementById('year-filter').value;
            const accreditationFilterValue = document.getElementById('accreditation-filter').value;
            const selectedStatuses = getSelectedStatuses();
            
            // Ensure we have valid data to filter
            if (!allData || Object.keys(allData).length === 0) {
                renderTableWithPagination({});
                return;
            }
            
            // Apply all filters and search
            let filteredData = {};
            
            Object.entries(allData).forEach(([key, value]) => {
                if (!value) return; // Skip invalid entries
                
                let matches = true;
                
                // Search by ID
                if (idSearchTerm && !value.research_id?.toString().toLowerCase().includes(idSearchTerm)) {
                    matches = false;
                }
                
                // Search by Title
                if (titleSearchTerm && !value.title?.toLowerCase().includes(titleSearchTerm)) {
                    matches = false;
                }
                
                // Filter by Year
                if (yearFilterValue && value.implementation_year?.toString() !== yearFilterValue) {
                    matches = false;
                }
                
                // Filter by Accreditation
                if (accreditationFilterValue && value.accreditation !== accreditationFilterValue) {
                    matches = false;
                }
                
                // Filter by Status - if no status selected, show all data
                if (selectedStatuses.length > 0 && !selectedStatuses.includes(value.status)) {
                    matches = false;
                }
                
                
                if (matches) {
                    filteredData[key] = value;
                }
            });
            
            // Update table with filtered data
            renderTableWithPagination(filteredData);
            
            // Update search info
            updateSearchInfo(idSearchTerm || titleSearchTerm, 'combined', Object.keys(filteredData).length);
            
            
        }
        
        function toggleStatusDropdown() {
            statusFilterDropdown.classList.toggle('hidden');
        }
        
        function handleStatusCheckboxChange() {
            const allCheckbox = document.querySelector('.status-checkbox[value=""]');
            const otherCheckboxes = document.querySelectorAll('.status-checkbox:not([value=""])');
            
            if (this.value === '') {
                // "Semua Status" checkbox clicked
                if (this.checked) {
                    // Check all other checkboxes when "Semua Status" is selected
                    otherCheckboxes.forEach(cb => {
                        cb.checked = true;
                    });
                } else {
                    // When "Semua Status" is unchecked, uncheck all other checkboxes
                    otherCheckboxes.forEach(cb => {
                        cb.checked = false;
                    });
                }
            } else {
                // Other checkbox clicked
                if (this.checked) {
                    // Uncheck "Semua Status" when individual status is selected
                    if (allCheckbox) {
                        allCheckbox.checked = false;
                    }
                } else {
                    // Check if all other checkboxes are unchecked, then check "Semua Status"
                    const allUnchecked = Array.from(otherCheckboxes).every(cb => !cb.checked);
                    if (allUnchecked && allCheckbox) {
                        allCheckbox.checked = true;
                    }
                }
            }
            
            // Update filter text
            updateStatusFilterText();
            
            // Apply filters immediately
            applyFilters();
            
            
        }
        
        
        
        
        
        function getSelectedStatuses() {
            const selectedStatuses = [];
            const allCheckbox = document.querySelector('.status-checkbox[value=""]');
            const otherCheckboxes = document.querySelectorAll('.status-checkbox:not([value=""])');
            
            // Jika "Semua Status" dicentang, return array kosong (tidak ada filter)
            if (allCheckbox && allCheckbox.checked) {
                return [];
            }
            
            // Jika "Semua Status" tidak dicentang, ambil status yang dicentang
            otherCheckboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    selectedStatuses.push(checkbox.value);
                }
            });
            
            return selectedStatuses;
        }
        
        function updateStatusFilterText() {
            const allCheckbox = document.querySelector('.status-checkbox[value=""]');
            const selectedStatuses = getSelectedStatuses();
            
            if (allCheckbox && allCheckbox.checked) {
                statusFilterText.textContent = 'Semua Status';
            } else if (selectedStatuses.length === 0) {
                statusFilterText.textContent = 'Tidak Ada Status Dipilih';
            } else if (selectedStatuses.length === 1) {
                statusFilterText.textContent = selectedStatuses[0];
            } else if (selectedStatuses.length <= 3) {
                // Tampilkan maksimal 3 status, sisanya dengan "..."
                const displayStatuses = selectedStatuses.slice(0, 3);
                const remaining = selectedStatuses.length - 3;
                if (remaining > 0) {
                    statusFilterText.textContent = `${displayStatuses.join(', ')} +${remaining} lainnya`;
                } else {
                    statusFilterText.textContent = displayStatuses.join(', ');
                }
            } else {
                statusFilterText.textContent = `${selectedStatuses.length} Status Dipilih`;
            }
        }
        

        
        // --- Collapse Functions ---
        function toggleCollapse(key) {
            const collapseRow = document.getElementById(`collapse-${key}`);
            
            if (collapseRow) {
                // Hide all other collapse rows first
                document.querySelectorAll('[id^="collapse-"]').forEach(row => {
                    if (row.id !== `collapse-${key}`) {
                            row.classList.add('hidden');
                    }
                });
                
                // Toggle current collapse row
                collapseRow.classList.toggle('hidden');
                } else {
                // If collapse row doesn't exist, create it
                createCollapseRow(key);
            }
        }
        
        function createCollapseRow(key) {
            const data = allData[key];
            if (!data) return;
            
            // Find the parent row
            const parentRow = document.querySelector(`button[data-key="${key}"]`)?.closest('tr');
            if (!parentRow) return;
            
            // Create collapse row
            const collapseRow = document.createElement('tr');
            collapseRow.id = `collapse-${key}`;
            collapseRow.classList.add('bg-gray-50', 'collapse-transition');
            
            collapseRow.innerHTML = `
                <td colspan="6" class="px-6 py-4">
                    <div class="bg-white border border-gray-200 rounded p-4">
                        <h4 class="text-sm font-semibold text-gray-800 mb-3">Detail Penelitian</h4>
                        <div class="space-y-3">
                            <div class="flex flex-wrap gap-2">
                                <div class="border border-gray-200 bg-gray-50 px-3 py-2">
                                    <div class="flex items-center">
                                        <span class="font-medium text-gray-600 w-24">Akreditasi:</span>
                                        <span class="text-gray-800">${data.accreditation || 'N/A'}</span>
                                    </div>
                                </div>
                                <div class="border border-gray-200 bg-gray-50 px-3 py-2">
                                    <div class="flex items-center">
                                        <span class="font-medium text-gray-600 w-24">Link Dokumen:</span>
                                        ${data.doc_link ? `<button onclick="generateEmbed('${data.doc_link}')" class="text-blue-600 hover:text-blue-800 hover:underline cursor-pointer">Preview</button>` : '<span class="text-gray-500">-</span>'}
                                    </div>
                                </div>
                                <div class="border border-gray-200 bg-gray-50 px-3 py-2">
                                    <div class="flex items-center">
                                        <span class="font-medium text-gray-600 w-24">Link Jurnal:</span>
                                        ${data.journal_link ? `<a href="${data.journal_link}" target="_blank" class="text-blue-600 hover:text-blue-800 hover:underline">Buka Link</a>` : '<span class="text-gray-500">-</span>'}
                                    </div>
                                </div>
                                <div class="border border-gray-200 bg-gray-50 px-3 py-2">
                                    <div class="flex items-center">
                                        <span class="font-medium text-gray-600 w-24">Tahun Publikasi:</span>
                                        <span class="text-gray-800">${data.published?.year_published || '-'}</span>
                                    </div>
                                </div>
                                <div class="border border-gray-200 bg-gray-50 px-3 py-2">
                                    <div class="flex items-center">
                                        <span class="font-medium text-gray-600 w-24">Link Publikasi:</span>
                                        ${data.published?.published_link ? `<a href="${data.published.published_link}" target="_blank" class="text-blue-600 hover:text-blue-800 hover:underline">Buka Link</a>` : '<span class="text-gray-500">-</span>'}
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-start">
                                <span class="font-medium text-gray-600 w-24 mt-1">Catatan:</span>
                                <span class="text-gray-800 whitespace-pre-wrap">${data.notes || '-'}</span>
                            </div>
                        </div>
                    </div>
                </td>
            `;
            
            // Insert collapse row after parent row
            parentRow.parentNode.insertBefore(collapseRow, parentRow.nextSibling);
        }
        

        
        function updateTableDisplay(data) {
            // Show no data message if empty
            const noDataRow = document.querySelector('.no-data-row');
            
            if (Object.keys(data).length === 0) {
                if (noDataRow) {
                    noDataRow.classList.remove('hidden');
                }
                return;
            }
            
            // Hide no data row, show data
            if (noDataRow) {
                noDataRow.classList.add('hidden');
            }
            
            // Reset to first page when filtering
            currentPage = 1;
            
                            Object.entries(data).forEach(([key, value]) => {
                const row = document.createElement('tr');
                row.classList.add('hover:bg-gray-50', 'table-row');
                
                row.innerHTML = `
                    <td class="px-3 py-3 whitespace-nowrap text-xs text-gray-600 border-r border-gray-300 text-center">${value.research_id || 'N/A'}</td>
                    <td class="px-3 py-3 border-r border-gray-300">
                        <div class="text-xs font-medium text-gray-800" title="${value.title || 'N/A'}">${value.title || 'N/A'}</div>
                    </td>
                    <td class="px-3 py-3 whitespace-nowrap border-r border-gray-300 text-center">
                        <span class="accreditation-badge">
                            ${value.status === 'Draft' || value.status === 'Writing' ? 'N/A' : (value.accreditation ? capitalizeAccreditation(value.accreditation) : 'N/A')}
                        </span>
                    </td>
                    <td class="px-3 py-3 whitespace-nowrap border-r border-gray-300 text-center">
                        <span class="status-text">
                            ${value.status || 'N/A'}
                        </span>
                    </td>
                    <td class="px-3 py-3 whitespace-nowrap text-xs text-gray-600 border-r border-gray-300 text-center">${value.implementation_year || 'N/A'}</td>
                    <td class="px-2 py-2 whitespace-nowrap text-xs font-medium action-column">
                        <div class="flex items-center justify-center space-x-1">
                            <button data-key="${key}" class="fresh-button view-btn" title="View">View</button>
                            <button data-key="${key}" class="fresh-button edit-btn" title="Edit">Edit</button>
                            <button data-key="${key}" class="fresh-button delete-btn" title="Delete">Delete</button>
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
                
                // Add collapse row for details
                const collapseRow = document.createElement('tr');
                collapseRow.id = `collapse-${key}`;
                collapseRow.classList.add('hidden', 'bg-gray-50', 'collapse-transition');
                collapseRow.innerHTML = `
                    <td colspan="6" class="px-6 py-4">
                        <div class="bg-white border border-gray-200 rounded p-4">
                            <h4 class="text-sm font-semibold text-gray-800 mb-3">Detail Penelitian</h4>
                            <div class="space-y-3">
                                <div class="flex flex-wrap gap-2">
                                    <div class="border border-gray-200 bg-gray-50 px-3 py-2">
                                        <div class="flex items-center">
                                            <span class="font-medium text-gray-600 w-24">Akreditasi:</span>
                                            <span class="text-gray-800">${value.accreditation || 'N/A'}</span>
                                        </div>
                                    </div>
                                        <div class="flex items-center">
                                            <span class="font-medium text-gray-600 w-24">Link Dokumen:</span>
                                            ${value.doc_link ? `<button onclick="generateEmbed('${value.doc_link}')" class="text-blue-600 hover:text-blue-800 hover:underline cursor-pointer">Preview</button>` : '<span class="text-gray-500">-</span>'}
                                    </div>                                    
                                    <div class="border border-gray-200 bg-gray-50 px-3 py-2">
                                        <div class="flex items-center">
                                            <span class="font-medium text-gray-600 w-24">Link Jurnal:</span>
                                            ${value.journal_link ? `<a href="${value.journal_link}" target="_blank" class="text-blue-600 hover:text-blue-800 hover:underline">Buka Link</a>` : '<span class="text-gray-500">-</span>'}
                                        </div>
                                    </div>

                                    <div class="border border-gray-200 bg-gray-50 px-3 py-2">
                                        <div class="flex items-center">
                                            <span class="font-medium text-gray-600 w-24">Tahun Publikasi:</span>
                                            <span class="text-gray-800">${value.published?.year_published || '-'}</span>
                                        </div>
                                    </div>
                                    <div class="border border-gray-200 bg-gray-50 px-3 py-2">
                                        <div class="flex items-center">
                                            <span class="font-medium text-gray-600 w-24">Link Publikasi:</span>
                                            ${value.published?.published_link ? `<a href="${value.published.published_link}" target="_blank" class="text-blue-600 hover:text-blue-800 hover:underline">Buka Link</a>` : '<span class="text-gray-500">-</span>'}
                                        </div>
                                    </div>
                                </div>
                                <div class="flex items-start">
                                    <span class="font-medium text-gray-600 w-24 mt-1">Catatan:</span>
                                    <span class="text-gray-800 whitespace-pre-wrap">${value.notes || '-'}</span>
                                </div>
                            </div>
                        </div>
                    </td>
                `;
                tableBody.appendChild(collapseRow);
            });
        }
        

        
        function loadResearchData() {
            // Firebase onValue listener akan otomatis update tabel
            // Jadi kita tidak perlu manual refresh
            console.log('Research data updated - table will refresh automatically');
            
            // Force re-render table with current data
            if (allData) {
                renderTableWithPagination(allData);
            }
        }
        
        function showToast(message, type = 'success') {
            // Log ke console untuk debugging
            console.log(`${type.toUpperCase()}: ${message}`);
            
            // Tampilkan alert hanya untuk operasi delete
            if (type === 'success' && message.includes('deleted')) {
                alert(`${message}`);
            }
        }
        
        // --- Pagination Functions ---
        function checkIfFiltersActive() {
            // Check if any filters are active
            const idSearch = document.getElementById('id-search').value.trim();
            const titleSearch = document.getElementById('title-search').value.trim();
            const yearFilter = document.getElementById('year-filter').value;
            const accreditationFilter = document.getElementById('accreditation-filter').value;
            const selectedStatuses = getSelectedStatuses();
            
            return idSearch !== '' || 
                   titleSearch !== '' || 
                   yearFilter !== '' || 
                   accreditationFilter !== '' || 
                   (selectedStatuses.length > 0 && !selectedStatuses.includes(''));
        }
        
        function renderTableWithPagination(data) {
            if (!data || Object.keys(data).length === 0) {
                // Check if filters are active
                const hasActiveFilters = checkIfFiltersActive();
                
                if (hasActiveFilters) {
                    // If filters are active, show table with "Data tidak ditemukan" message
                    const tableContainer = document.querySelector('.table_component');
                    const paginationContainer = document.getElementById('pagination-container');
                    
                    if (tableContainer) {
                        tableContainer.style.display = 'block';
                    }
                    
                    if (paginationContainer) {
                        paginationContainer.style.display = 'none';
                    }
                    
                    // Clear existing data rows and collapse rows
                    const existingDataRows = document.querySelectorAll('.table-row:not(.no-data-row)');
                    const existingCollapseRows = document.querySelectorAll('[id^="collapse-"]');
                    existingDataRows.forEach(row => row.remove());
                    existingCollapseRows.forEach(row => row.remove());
                    
                    // Show no data message in table
                    const noDataRow = document.querySelector('.no-data-row');
                    if (noDataRow) {
                        noDataRow.classList.remove('hidden');
                        const noDataMessage = document.getElementById('no-data-message');
                        noDataMessage.textContent = 'Data tidak ditemukan';
                    }
                } else {
                    // If no filters active, hide table completely
                    const tableContainer = document.querySelector('.table_component');
                    const paginationContainer = document.getElementById('pagination-container');
                    
                    if (tableContainer) {
                        tableContainer.style.display = 'none';
                    }
                    
                    if (paginationContainer) {
                        paginationContainer.style.display = 'none';
                    }
                    
                    // Show no data message
                    const noDataRow = document.querySelector('.no-data-row');
                    if (noDataRow) {
                        noDataRow.classList.remove('hidden');
                        const noDataMessage = document.getElementById('no-data-message');
                        noDataMessage.textContent = 'Data tidak ditemukan';
                    }
                }
                
                updatePaginationInfo(0, 0, 0);
                return;
            }
            
            // Show table and pagination when there is data
            const tableContainer = document.querySelector('.table_component');
            const paginationContainer = document.getElementById('pagination-container');
            
            if (tableContainer) {
                tableContainer.style.display = 'block';
            }
            
            if (paginationContainer) {
                paginationContainer.style.display = 'flex';
            }
            
            // Convert data to array format for pagination
            filteredData = Object.entries(data);
            
            const totalItems = filteredData.length;
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            
            // Ensure current page is valid
            if (currentPage > totalPages) {
                currentPage = totalPages;
            }
            if (currentPage < 1) {
                currentPage = 1;
            }
            
            // Get current page data
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const currentPageData = filteredData.slice(startIndex, endIndex);
            
            // Hide no data row
            const noDataRow = document.querySelector('.no-data-row');
            
            if (noDataRow) {
                noDataRow.classList.add('hidden');
            }
            
            // Clear existing data rows and collapse rows (but keep no-data row)
            const existingDataRows = document.querySelectorAll('.table-row:not(.no-data-row)');
            const existingCollapseRows = document.querySelectorAll('[id^="collapse-"]');
            existingDataRows.forEach(row => row.remove());
            existingCollapseRows.forEach(row => row.remove());
            
            // Ensure all collapse rows are hidden
            document.querySelectorAll('[id^="collapse-"]').forEach(row => {
                row.classList.add('hidden');
            });
            
            // Render current page data
            currentPageData.forEach(([key, value]) => {
                const row = document.createElement('tr');
                row.classList.add('hover:bg-gray-50', 'table-row');
                
                row.innerHTML = `
                    <td class="px-3 py-3 whitespace-nowrap text-xs text-gray-600 border-r border-gray-300 text-center" data-label="ID">${value.research_id || 'N/A'}</td>
                    <td class="px-3 py-3 border-r border-gray-300" data-label="Judul">
                        <div class="text-xs font-medium text-gray-800" title="${value.title || 'N/A'}">${value.title || 'N/A'}</div>
                    </td>
                    <td class="px-3 py-3 whitespace-nowrap text-xs text-gray-600 border-r border-gray-300 text-center" data-label="Tahun Penelitian">${value.implementation_year || 'N/A'}</td>
                    <td class="px-3 py-3 whitespace-nowrap border-r border-gray-300 text-center" data-label="Status">
                        <span class="status-text">${value.status || 'N/A'}</span>
                    </td>
                    <td class="px-3 py-3 whitespace-nowrap border-r border-gray-300 text-center" data-label="Akreditasi">
                        <span class="accreditation-badge">
                            ${value.status === 'Draft' || value.status === 'Writing' ? 'N/A' : (value.accreditation ? capitalizeAccreditation(value.accreditation) : 'N/A')}
                        </span>
                    </td>
                    <td class="px-2 py-2 whitespace-nowrap text-xs font-medium action-column" data-label="Aksi">
                        <div class="flex items-center justify-center space-x-1">
                            <button data-key="${key}" class="fresh-button view-btn" title="View">View</button>
                            <button data-key="${key}" class="fresh-button edit-btn" title="Edit">Edit</button>
                            <button data-key="${key}" class="fresh-button delete-btn" title="Delete">Delete</button>
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
                
                // Add collapse row for details immediately after the data row
                const collapseRow = document.createElement('tr');
                collapseRow.id = `collapse-${key}`;
                collapseRow.classList.add('hidden', 'bg-gray-50', 'collapse-transition');
                collapseRow.innerHTML = `
                    <td colspan="6" class="px-6 py-4">
                        <div class="bg-white border border-gray-200 rounded p-4">
                            <h4 class="text-sm font-semibold text-gray-800 mb-3">Detail Penelitian</h4>
                            <div class="space-y-3">
                                <div class="flex flex-wrap gap-2">
                                    <div class="border border-gray-200 bg-gray-50 px-3 py-2">
                                        <div class="flex items-center">
                                            <span class="font-medium text-gray-600 w-24">Akreditasi:</span>
                                            <span class="text-gray-800">${value.accreditation || 'N/A'}</span>
                                        </div>
                                    </div>
                                    <div class="border border-gray-200 bg-gray-50 px-3 py-2">
                                        <div class="flex items-center">
                                            <span class="font-medium text-gray-600 w-24">Link Dokumen:</span>
                                            ${value.doc_link ? `<button onclick="generateEmbed('${value.doc_link}')" class="text-blue-600 hover:text-blue-800 hover:underline cursor-pointer">Preview</button>` : '<span class="text-gray-500">-</span>'}
                                        </div>
                                    </div>
                                    <div class="border border-gray-200 bg-gray-50 px-3 py-2">
                                        <div class="flex items-center">
                                            <span class="font-medium text-gray-600 w-24">Link Jurnal:</span>
                                            ${value.journal_link ? `<a href="${value.journal_link}" target="_blank" class="text-blue-600 hover:text-blue-800 hover:underline">Buka Link</a>` : '<span class="text-gray-500">-</span>'}
                                        </div>
                                    </div>
                                    <div class="border border-gray-200 bg-gray-50 px-3 py-2">
                                        <div class="flex items-center">
                                            <span class="font-medium text-gray-600 w-24">Tahun Publikasi:</span>
                                            <span class="text-gray-800">${value.published?.year_published || '-'}</span>
                                        </div>
                                    </div>
                                    <div class="border border-gray-200 bg-gray-50 px-3 py-2">
                                        <div class="flex items-center">
                                            <span class="font-medium text-gray-600 w-24">Link Publikasi:</span>
                                            ${value.published?.published_link ? `<a href="${value.published.published_link}" target="_blank" class="text-blue-600 hover:text-blue-800 hover:underline">Buka Link</a>` : '<span class="text-gray-500">-</span>'}
                                        </div>
                                    </div>
                                </div>
                                <div class="flex items-start">
                                    <span class="font-medium text-gray-600 w-24 mt-1">Catatan:</span>
                                    <span class="text-gray-800 whitespace-pre-wrap">${value.notes || '-'}</span>
                                </div>
                            </div>
                        </div>
                    </td>
                `;
                tableBody.appendChild(collapseRow);
            });
            

            

            
            // Update pagination
            updatePaginationInfo(startIndex + 1, endIndex, totalItems);
            renderPageNumbers(totalPages);
            updateNavigationButtons(totalPages);
            
            // Ensure all collapse rows are properly positioned and hidden
            setTimeout(() => {
                document.querySelectorAll('[id^="collapse-"]').forEach(row => {
                    row.classList.add('hidden');
                });
            }, 50);
        }
        
        function updatePaginationInfo(start, end, total) {
            const pageInfo = document.getElementById('page-info');
            if (total === 0) {
                pageInfo.textContent = 'Tidak ada data';
            } else {
                pageInfo.textContent = `Menampilkan ${start}-${Math.min(end, total)} dari ${total} data`;
            }
        }
        
        function renderPageNumbers(totalPages) {
            const pageNumbersContainer = document.getElementById('page-numbers');
            pageNumbersContainer.innerHTML = '';
            
            if (totalPages <= 1) {
                return;
            }
            
            // Tampilkan semua nomor halaman
            for (let i = 1; i <= totalPages; i++) {
                    addPageNumber(i);
            }
        }
        
        function addPageNumber(pageNum, type = 'number') {
            const pageNumbersContainer = document.getElementById('page-numbers');
            const pageBtn = document.createElement('button');
            
                pageBtn.textContent = pageNum;
                pageBtn.className = `fresh-pagination-btn ${pageNum === currentPage ? 'active' : ''}`;
                pageBtn.addEventListener('click', () => goToPage(pageNum));
            
            pageNumbersContainer.appendChild(pageBtn);
        }
        
        function updateNavigationButtons(totalPages) {
            const prevBtn = document.getElementById('prev-page');
            const nextBtn = document.getElementById('next-page');
            
            prevBtn.disabled = currentPage <= 1;
            nextBtn.disabled = currentPage >= totalPages;
        }
        
        function goToPage(page) {
            currentPage = page;
            // Use filtered data if available, otherwise use all data
            const dataToRender = filteredData && filteredData.length > 0 ? 
                Object.fromEntries(filteredData) : allData;
            renderTableWithPagination(dataToRender);
        }
        
        function goToPreviousPage() {
            if (currentPage > 1) {
                goToPage(currentPage - 1);
            }
        }
        
        function goToNextPage() {
            const dataToCheck = filteredData && filteredData.length > 0 ? 
                Object.fromEntries(filteredData) : allData;
            const totalPages = Math.ceil(Object.keys(dataToCheck).length / itemsPerPage);
            if (currentPage < totalPages) {
                goToPage(currentPage + 1);
            }
        }
        
        function changeItemsPerPage(newItemsPerPage) {
            itemsPerPage = parseInt(newItemsPerPage);
            currentPage = 1; // Reset to first page
            // Use filtered data if available, otherwise use all data
            const dataToRender = filteredData && filteredData.length > 0 ? 
                Object.fromEntries(filteredData) : allData;
            renderTableWithPagination(dataToRender);
        }

        // ===== SEARCH FUNCTIONS =====
        function setupSearchListeners() {
            const idSearch = document.getElementById('id-search');
            const titleSearch = document.getElementById('title-search');
            
            // Debounce function to limit search frequency
            let searchTimeout;
            
            // Search by ID with debouncing
            idSearch.addEventListener('input', (e) => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    const searchTerm = e.target.value.toLowerCase().trim();
                    performSearch(searchTerm, 'id');
                }, 300); // 300ms delay
            });
            
            // Search by Title with debouncing
            titleSearch.addEventListener('input', (e) => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    const searchTerm = e.target.value.toLowerCase().trim();
                    performSearch(searchTerm, 'title');
                }, 300); // 300ms delay
            });
        }
        
        function performSearch(searchTerm, searchType) {
            if (!allData) return;
            
            // Show loading state (optional)
            const searchInput = searchType === 'id' ? 
                document.getElementById('id-search') : 
                document.getElementById('title-search');
            
            // Apply filters immediately when searching
            applyFilters();
        }
        
        function updateSearchInfo(searchTerm, searchType, resultCount) {
            const pageInfo = document.getElementById('page-info');
            
            if (searchTerm === '') {
                // Tampilkan info normal jika tidak ada search
                const totalItems = Object.keys(allData).length;
                const startIndex = (currentPage - 1) * itemsPerPage;
                const endIndex = startIndex + itemsPerPage;
                updatePaginationInfo(startIndex + 1, endIndex, totalItems);
            } else if (searchType === 'combined') {
                // Tampilkan info hasil filter dan search yang digabung
                const idSearchTerm = document.getElementById('id-search').value.toLowerCase().trim();
                const titleSearchTerm = document.getElementById('title-search').value.toLowerCase().trim();
                const yearFilterValue = document.getElementById('year-filter').value;
                const accreditationFilterValue = document.getElementById('accreditation-filter').value;
                const selectedStatuses = getSelectedStatuses();
                
                let searchInfo = [];
                if (idSearchTerm) searchInfo.push(`ID: "${idSearchTerm}"`);
                if (titleSearchTerm) searchInfo.push(`Judul: "${titleSearchTerm}"`);
                if (yearFilterValue) searchInfo.push(`Tahun: ${yearFilterValue}`);
                if (accreditationFilterValue) searchInfo.push(`Akreditasi: ${accreditationFilterValue}`);
                if (selectedStatuses.length > 0 && selectedStatuses.length < 7) {
                    searchInfo.push(`Status: ${selectedStatuses.join(', ')}`);
                }
                
                if (searchInfo.length > 0) {
                    pageInfo.textContent = `Hasil filter ${searchInfo.join(', ')}: ${resultCount} data ditemukan`;
                } else {
                    // Hanya filter yang aktif
                    pageInfo.textContent = `Menampilkan ${resultCount} data`;
                }
            } else {
                // Tampilkan info hasil pencarian
                const searchTypeText = searchType === 'id' ? 'ID' : 'Judul';
                pageInfo.textContent = `Hasil pencarian "${searchTerm}" (${searchTypeText}): ${resultCount} data ditemukan`;
            }
        }
        

        
        // ===== DEBUG FUNCTIONS =====

    </script>

    <!-- Document Preview Script -->
    <script>
        // ===== DOCUMENT PREVIEW FUNCTIONS =====
        function generateEmbed(driveLink) {
            // Bersihkan link dari karakter @ di awal jika ada
            let cleanLink = driveLink.trim();
            if (cleanLink.startsWith('@')) {
                cleanLink = cleanLink.substring(1);
            }
            
            let fileId = null;
            let embedUrl = null;
            
            // Pattern 1: Google Drive open link format
            // https://drive.google.com/open?id=FILE_ID&usp=drive_copy
            const openMatch = cleanLink.match(/drive\.google\.com\/open\?id=([a-zA-Z0-9_-]+)/);
            if (openMatch) {
                fileId = openMatch[1];
                embedUrl = `https://drive.google.com/file/d/${fileId}/preview`;
            }
            
            // Pattern 2: Google Drive direct link format
            // https://drive.google.com/file/d/FILE_ID/view
            const directMatch = cleanLink.match(/drive\.google\.com\/file\/d\/([a-zA-Z0-9_-]+)/);
            if (directMatch) {
                fileId = directMatch[1];
                embedUrl = `https://drive.google.com/file/d/${fileId}/preview`;
            }
            
            // Pattern 3: Google Docs edit link format
            // https://docs.google.com/document/d/FILE_ID/edit?usp=drive_link
            const docsEditMatch = cleanLink.match(/docs\.google\.com\/document\/d\/([a-zA-Z0-9_-]+)\/edit/);
            if (docsEditMatch) {
                fileId = docsEditMatch[1];
                embedUrl = `https://drive.google.com/file/d/${fileId}/preview`;
            }
            
            // Pattern 4: Google Docs sharing link format
            // https://docs.google.com/document/d/FILE_ID/edit?usp=sharing
            const docsSharingMatch = cleanLink.match(/docs\.google\.com\/document\/d\/([a-zA-Z0-9_-]+)\/edit\?usp=sharing/);
            if (docsSharingMatch) {
                fileId = docsSharingMatch[1];
                embedUrl = `https://drive.google.com/file/d/${fileId}/preview`;
            }
            
            // Pattern 5: Google Sheets format
            const sheetsMatch = cleanLink.match(/docs\.google\.com\/spreadsheets\/d\/([a-zA-Z0-9_-]+)/);
            if (sheetsMatch) {
                fileId = sheetsMatch[1];
                embedUrl = `https://drive.google.com/file/d/${fileId}/preview`;
            }
            
            // Pattern 6: Google Slides format
            const slidesMatch = cleanLink.match(/docs\.google\.com\/presentation\/d\/([a-zA-Z0-9_-]+)/);
            if (slidesMatch) {
                fileId = slidesMatch[1];
                embedUrl = `https://drive.google.com/file/d/${fileId}/preview`;
            }
            
            if (fileId && embedUrl) {
                // Set iframe src untuk menampilkan file
                const iframe = document.getElementById("fileIframe");
                if (iframe) {
                    iframe.src = embedUrl;
                }

                // Tampilkan pop-up
                const popup = document.getElementById("popup");
                const overlay = document.getElementById("popupOverlay");
                
                if (popup && overlay) {
                    overlay.style.display = "flex"; // Menggunakan flex untuk centering
                    popup.style.display = "block";
                }
            } else {
                alert("Link tidak valid. Format yang didukung:\n" +
                      "• Google Drive: https://drive.google.com/open?id=FILE_ID\n" +
                      "• Google Drive: https://drive.google.com/file/d/FILE_ID/view\n" +
                      "• Google Docs: https://docs.google.com/document/d/FILE_ID/edit\n" +
                      "• Google Sheets: https://docs.google.com/spreadsheets/d/FILE_ID\n" +
                      "• Google Slides: https://docs.google.com/presentation/d/FILE_ID");
            }
        }

        function closePopup() {
            // Tutup pop-up
            const popup = document.getElementById("popup");
            const overlay = document.getElementById("popupOverlay");
            const iframe = document.getElementById("fileIframe");
            
            if (popup && overlay) {
                popup.style.display = "none";
                overlay.style.display = "none";
            }
            
            // Clear iframe src untuk menghemat bandwidth
            if (iframe) {
                iframe.src = "";
            }
        }

        // Close popup when clicking overlay
        document.addEventListener('DOMContentLoaded', function() {
            const overlay = document.getElementById("popupOverlay");
            if (overlay) {
                overlay.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closePopup();
                    }
                });
            }
        });
    </script>

    <!-- Footer -->
    <footer class="py-6 mt-8">
        <div class="container mx-auto px-4">
            <div class="border-t border-gray-200 pt-6">
                <!-- Clean footer without content -->
            </div>
        </div>
    </footer>
</body>
</html>
